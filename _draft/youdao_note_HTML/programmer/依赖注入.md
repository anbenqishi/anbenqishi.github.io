::: {#sidebar}
::: {#outline}
:::
:::

::: {#page-container}
::: {#pf1 .pf .w0 .h0 page-no="1"}
::: {.pc .pc1 .w0 .h0}
![](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAA+AAAAXLCAIAAAAz/kHlAAAACXBIWXMAABYlAAAWJQFJUiTwAAAgAElEQVR42uzdX2heZ+HA8fM26Z8t7X7dRcorm1BBvCjz7ZUM50QG0QsVdDeV1OGNDBzUFPVOwZmAeFXFtujF7gaN6M02sB1KYQwSpXeSQgURE3DSkLBmTd+3afP+Ob+L0z2cnvO+J+dNmi558/nQiy5785xznvNm+74n508ljuMIAADYGfaZAgAAEOgAAIBABwAAgQ4AAAh0AAAQ6AAAgEAHAACBDgAACHQAABDoAACAQAcAAIEOAAAIdAAAQKADAIBABwAABDoAAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwCAQAcAAAQ6AAAIdAAAQKADAAACHQAABDoAACDQAQBAoAMAAAIdAAAEOgAAINABAECgAwAAAh0AAAQ6AAAg0AEAQKADAAACHQAAEOgAACDQAQAAgQ4AAAIdAAAQ6AAAINABAACBDgAAAh0AABDoAAAg0AEAAIEOAAACHQAAEOgAAIBABwAAgQ4AAAh0AAAQ6AAAgEAHAACBDgAACHQAABDoAACAQAcAAIEOAAAIdAAAEOgAAIBABwAABDoAAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwCAQAcAAAQ6AAAIdAAAQKADAIBABwAABDoAACDQAQBAoAMAAAIdAAAEOgAAINABAECgAwAAAh0AAAQ6AAAg0AEAQKADAAACHQAABDoAACDQAQAAgQ4AAAIdAAAQ6AAAINABAACBDgAAAh0AABDoAAAg0AEAAIEOAAACHQAAEOgAACDQAQAAgQ4AAAh0AAAQ6AAAgEAHAACBDgAACHQAABDoAACAQAcAAIEOAAAIdAAAEOgAAIBABwAAgQ4AAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwCAQAcAAAQ6AAAIdAAAQKADAIBABwAABDoAAAh0AABAoAMAAAIdAAAEOgAAINABAECgAwAAAh0AAAQ6AAAg0AEAQKADAAACHQAABDoAACDQAQBAoAMAAAIdAAAQ6AAAINABAACBDgAAAh0AABDoAAAg0AEAAIEOAAACHQAAEOgAACDQAQAAgQ4AAAIdAAAQ6AAAgEAHAACBDgAACHQAABDoAACAQAcAAIEOAAAIdAAAEOgAAIBABwAAgQ4AAAh0AAAQ6AAAgEAHAAAEOgAACHQAAECgAwCAQAcAAAQ6AAAIdAAAQKADAIBABwAABDoAAAh0AABAoAMAgEAHAAAEOgAAINABAECgAwAAAh0AAAQ6AAAg0AEAQKADAAACHQAABDoAACDQAQBAoAMAAAIdAAAEOgAAINABAACBDgAAAh0AABDoAAAg0AEAAIEOAAACHQAAEOgAACDQAQAAgQ4AAAIdAAAQ6AAAINABAACBDgAACHQAABDoAACAQAcAAIEOAAAIdAAAEOgAAIBABwAAgQ4AAAh0AAAQ6AAAgEAHAACBDgAACHQAAECgAwCAQAcAAAQ6AAAIdAAAQKADAIBABwAABDoAAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwAAAh0AAAQ6AAAg0AEAQKADAAACHQAABDoAACDQAQBAoAMAAAIdAAAEOgAAINABAECgAwAAAh0AABDoAAAg0AEAAIEOAAACHQAAEOgAACDQAQAAgQ4AAAIdAAAQ6AAAINABAACBDgAAAt0UAACAQAcAAAQ6AAAIdAAAQKADAIBABwAABDoAAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwAAAh0AAAQ6AAAg0AEAQKADAAACHQAABDoAACDQAQBAoAMAAAIdAAAEOgAAINABAECgAwAAAh0AABDoAAAg0AEAAIEOAAACHQAAEOgAACDQAQAAgQ4AAAIdAAAQ6AAAINABAACBDgAAAh0AABDoAACAQAcAAIEOAAAIdAAAEOgAAIBABwAAgQ4AAAh0AAAQ6AAAgEAHAACBDgAACHQAABDoAACAQAcAAAQ6AAAIdAAAQKADAIBABwAABDoAAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwCAQAcAAAQ6AAAg0AEAQKADAAACHQAABDoAACDQAQBAoAMAAAIdAAAEOgAAINABAECgAwAAAh0AAAQ6AAAg0AEAAIEOAAACHQAAEOgAACDQAQAAgQ4AAAIdAAAQ6AAAINABAACBDgAAAh0AABDoAAAg0AEAAIEOAAAIdAAAEOgAAIBABwAAgQ4AAAh0AAAQ6AAAgEAHAACBDgAACHQAABDoAACAQAcAAIEOAAAIdAAAQKADAIBABwAABDoAAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwCAQAcAAAQ6AAAIdAAAQKADAAACHQAABDoAACDQAQBAoAMAAAIdAAAEOgAAINABAECgAwAAAh0AAAQ6AAAg0AEAQKADAAACHQAAEOgAACDQAQAAgQ4AAAIdAAAQ6AAAINABAACBDgAAAh0AABDoAAAg0AEAAIEOAAACHQAAEOgAAIBABwAAgQ4AAAh0AAAQ6AAAgEAHAACBDgAACHQAABDoAACAQAcAAIEOAAAIdAAAEOgAAIBABwAABDoAAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwCAQAcAAAQ6AAAIdAAAQKADAIBABwAABDoAACDQAQBAoAMAAAIdAAAEOgAAINABAECgAwAAAh0AAAQ6AAAg0AEAQKADAAACHQAABDoAACDQAQAAgQ4AAAIdAAAQ6AAAINABAACBDgAAAh0AABDoAAAg0AEAAIEOAAACHQAAEOgAALCXDZsCiKKoUlkxCbtIHD9tEgAY2CyJ49gsAADADuEUFwAAEOgAAIBABwAAgQ4AAAh0AAAQ6AAAgEAHAACBDgAACHQAABDoAACAQAcAAIEOAAAIdAAAQKADAIBABwAABDoAAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwCAQAcAAAQ6AAAIdAAAQKADAAACHQAABDoAACDQAQBAoAMAAAIdAAAEOgAAINABAECgAwAAAh0AAAQ6AAAg0AEAQKADAAACHQAAEOgAACDQAQAAgQ4AAAIdAAAQ6AAAINABAACBDgAAAh0AABDoAAAg0AEAAIEOAAACHQAAEOgAAIBABwAAgQ4AAAh0AAAQ6AAAgEAHAACBDgAACHQAABDoAACAQAcAAIEOAAAIdAAAEOgAAIBABwAABDoAAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwCAQAcAAAQ6AAAIdAAAQKADAIBABwAABDoAACDQAQBAoAMAAAIdAAAEOgAAINABAECgAwAAAh0AAAQ6AAAg0AEAQKADAAACHQAABDoAACDQAQAAgQ4AAAIdAAAQ6AAAINABAACBDgAAAh0AABDoAAAg0AEAAIEOAAACHQAAEOgAACDQAQAAgQ4AAAh0AAAQ6AAAgEAHAACBDgAACHQAABDoAACAQAcAAIEOAAAIdAAAEOgAAIBABwAAgQ4AAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwCAQAcAAAQ6AAAIdAAAQKADAIBABwAABDoAAAh0AABAoAMAAAIdAAAEOgAAINABAECgAwAAAh0AAAQ6AAAg0AEAQKADAAACHQAABDoAACDQAQBAoAMAAAIdAAAQ6AAAINABAACBDgAAAh0AABDoAAAg0AEAAIEOAAACHQAAEOgAACDQAQAAgQ4AAAIdAAAQ6AAAgEAHAACBDgAACHQAABDoAACAQAcAAIEOAAAIdAAAEOgAAIBABwAAgQ4AAAh0AAAQ6AAAgEAHAAAEOgAACHQAAECgAwCAQAcAAAQ6AAAIdAAAQKADAIBABwAABDoAAAh0AABAoAMAgEAHAAAEOgAAINABAECgAwAAAh0AAAQ6AAAg0AEAQKADAAACHQAABDoAACDQAQBAoAMAAAIdAAAEOgAAINABAACBDgAAAh0AABDoAAAg0AEAAIEOAAACHQAAEOgAACDQAQAAgQ4AAAIdAAAQ6AAAINABAACBDgAACHQAABDoAACAQAcAAIEOAAAIdAAAEOgAAIBABwAAgQ4AAAh0AAAQ6AAAgEAHAACBDgAACHQAAECgAwCAQAcAAAQ6AAAIdAAAQKADAIBABwAABDoAAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwAAAh0AAAQ6AAAg0AEAQKADAAACHQAABDoAACDQAQBAoAMAAAIdAAAEOgAAINABAECgmwIAABDoAACAQAcAAIEOAAAIdAAAEOgAAIBABwAAgQ4AAAh0AAAQ6AAAgEAHAACBDgAACHQAAECgAwCAQAcAAAQ6AAAIdAAAQKADAIBABwAABDoAAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwAAAh0AAAQ6AAAg0AEAQKADAAACHQAABDoAACDQAQBAoAMAAAIdAAAEOgAAINABAECgAwAAAh0AABDoAAAg0AEAAIEOAAACHQAAEOgAACDQAQAAgQ4AAAIdAAAQ6AAAINABAACBDgAAAh0AABDoAACAQAcAAIEOAAAIdAAAEOgAAIBABwAAgQ4AAAh0AAAQ6AAAgEAHAACBDgAACHQAABDoAACAQAcAAAQ6AAAIdAAAQKADAIBABwAABDoAAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwCAQAcAAAQ6AAAg0AEAQKADAAACHQAABDoAACDQAQBAoAMAAAIdAAAEOgAAINABAECgAwAAAh0AAAQ6AAAg0AEAAIEOAAACHQAAEOgAACDQAQAAgQ4AAAIdAAAQ6AAAINABAACBDgAAAh0AABDoAAAg0AEAAIEOAAAIdAAAEOgAAIBABwAAgQ4AAAh0AAAQ6AAAgEAHAACBDgAACHQAABDoAACAQAcAAIEOAAAIdAAAQKADAIBABwAABDoAAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwCAQAcAAAQ6AAAIdAAAQKADAAACHQAABDoAACDQAQBAoAMAAAIdAAAEOgAAINABAECgAwAAAh0AAAQ6AAAg0AEAQKADAAACHQAAEOgAACDQAQAAgQ4AAAIdAAAQ6AAAINABAACBDgAAAh0AABDoAAAg0AEAAIEOAAACHQAAEOgAAIBABwAAgQ4AAAh0AAAQ6AAAgEAHAACBDgAACHQAABDoAACAQAcAAIEOAAAIdAAAEOgAAIBABwAABDoAAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwCAQAcAAAQ6AAAIdAAAQKADAIBABwAABDoAACDQAQBAoAMAAAIdAAAEOgAAINABAECgAwAAAh0AAAQ6AAAg0AEAQKADAAACHQAABDoAALAjDJsC+lKprJgEYIeI46dNAjCAuRXHsVkAAIAdwikuAAAg0AEAAIEOAAACHQAAEOgAACDQAQAAgQ4AAAIdAAAQ6AAAINABAACBDgAAAh0AABDoAACAQAcAAIEOAAAIdAAAEOgAAIBABwAAgQ4AAAh0AAAQ6AAAgEAHAACBDgAACHQAABDoAACAQAcAAAQ6AAAIdAAAQKADAIBABwAABDoAAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwCAQAcAAAQ6AAAg0AEAQKADAAACHQAABDoAACDQAQBAoAMAAAIdAAAEOgAAINABAECgAwAAAh0AAAQ6AAAg0AEAAIEOAAACHQAAEOgAACDQAQAAgQ4AAAIdAAAQ6AAAINABAACBDgAAAh0AABDoAAAg0AEAAIEOAAAIdAAAEOgAAIBABwAAgQ4AAAh0AAAQ6AAAgEAHAACBDgAACHQAABDoAACAQAcAAIEOAAAIdAAAQKADAIBABwAABDoAAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwCAQAcAAAQ6AAAIdAAAQKADAAACHQAABDoAACDQAQBAoAMAAAIdAAAEOgAAINABAECgAwAAAh0AAAQ6AAAg0AEAQKADAAACHQAAEOgAACDQAQAAgQ4A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AAAIdAAAQKADAAACHQAABDoAACDQAQBAoAMAAAIdAAAEOgAAINABAECgAwAAAh0AAAQ6AAAg0AEAQKADAAACHQAAEOgAACDQAQAAgQ4AAAIdAAAQ6AAAINABAACBDgAAAh0AABDoAAAg0AEAAIEOAAACHQAAEOgAAIBABwAAgQ4AAAh0AAAQ6AAAgEAHAACBDgAACHQAABDoAKBVwkYAAAWYSURBVACAQAcAAIEOAAAIdAAAEOgAAIBABwAABDoAAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwCAQAcAAAQ6AAAIdAAAQKADAIBABwAABDoAACDQAQBAoAMAAAIdAAAEOgAAINABAECgAwAAAh0AAAQ6AAAg0AEAQKADAAACHQAABDoAACDQAQAAgQ4AAAIdAAAQ6AAAINABAACBDgAAAh0AABDoAAAg0AEAAIEOAAACHQAAEOgAACDQAQAAgQ4AAAh0AAAQ6AAAgEAHAACBDgAACHQAABDoAACAQAcAAIEOAAAIdAAAEOgAAIBABwAAgQ4AAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwCAQAcAAAQ6AAAIdAAAQKADAIBABwAABDoAAAh0AABAoAMAAAIdAAAEOgAAINABAECgAwAAAh0AAAQ6AAAg0AEAQKADAAACHQAABDoAACDQAQBAoAMAAAIdAAAQ6AAAINABAACBDgAAAh0AABDoAAAg0AEAAIEOAAACHQAAEOgAACDQAQAAgQ4AAAIdAAAQ6AAAgEAHAACBDgAACHQAABDoAACAQAcAAIEOAAAIdAAAEOgAAIBABwAAgQ4AAAh0AAAQ6AAAgEAHAAAEOgDA/7dbxwIAAAAAwvytQ0hgQ+gKDDoAAGDQAQDAoAMAAAYdAAAMOgAAYNABAMCgAwAABh0AAAw6AABg0AEAwKADAAAGHQAAMOgAAGDQAQAAgw4AAAYdAAAw6AAAYNABAACDDgAABh0AADDoAABg0AEAAIMOAAAGHQAAMOgAAIBBBwAAgw4AABh0AAAw6AAAgEEHAACDDgAAGHQAADDoAACAQQcAAIMOAAAYdAAAMOgAAIBBBwAADDoAABh0AADAoAMAgEEHAAAMOgAAGHQAAMCgAwCAQQcAAAw6AAAYdAAAwKADAIBBlwAAAAw6AABg0AEAwKADAAAGHQAADDoAAGDQAQDAoAMAAAYdAAAMOgAAYNABAMCgAwAABh0AADDoAABg0AEAAIMOAAAGHQAAMOgAAGDQAQAAgw4AAAYdAAAw6AAAYNABAACDDgAABh0AADDoAACAQQcAAIMOAAAYdAAAMOgAAIBBBwAAgw4AABh0AAAw6AAAgEEHAACDDgAAGHQAADDoAACAQQcAAAw6AAAYdAAAwKADAIBBBwAADDoAABh0AADAoAMAgEEHAAAMOgAAGHQAAMCgAwCAQQcAAAw6AABg0AEAwKADAAAGHQAADDoAAGDQAQDAoAMAAAYdAAAMOgAAYNABAMCgAwAABh0AAAw6AABg0AEAAIMOAAAGHQAAMOgAAGDQAQAAgw4AAAYdAAAw6AAAYNABAACDDgAABh0AADDoAABg0AEAAIMOAAAYdAAAMOgAAIBBBwAAgw4AABh0AAAw6AAAgEEHAACDDgAAGHQAADDoAACAQQcAAIMOAAAYdAAAwKADAIBBBwAADDoAABh0AADAoAMAgEEHAAAMOgAAGHQAAMCgAwCAQQcAAAw6AAAYdAAAwKADAAAGHQAADDoAAGDQAQDAoAMAAAYdAAAMOgAAYNABAMCgAwAABh0AAAw6AABg0AEAwKADAAAGHQAAMOgAAGDQAQAAgw4AAAYdAAAw6AAAYNABAACDDgAABh0AADDoAABg0AEAAIMOAAAGHQAAMOgAAIBBBwAAgw4AABh0AAAw6AAAgEEHAACDDgAAGHQAADDoAACAQQcAAIMOAAAYdAAAMOgAAIBBBwAADDoAABh0AADAoAMAgEEHAAAMOgAAGHQAAMCgAwCAQQcAAAw6AAAYdAAAwKADAIBBBwAADDoAAGDQAQDAoAMAAAYdAAAMOgAAYNABAMCgAwAABh0AAAw6AABg0AEAwKADAAAGHQAADDoAAGDQAQAAgw4AAAYdAAA4AX1FWu4A+6i3AAAAAElFTkSuQmCC){.bi
.x0 .y0 .w1 .h1}

::: {.c .x0 .y1 .w1 .h2}
::: {.t .m0 .x1 .h3 .y2 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
从一个例子开始，比如说写了这样一个方法：
:::

::: {.t .m0 .x1 .h4 .y3 .ff2 .fs1 .fc0 .sc0 .ls0 .ws0}
\- (NSNumber \*)nextReminderId{ NSNumber \*currentReminderId =
\[\[NSUserDefaults
:::

::: {.t .m0 .x1 .h4 .y4 .ff2 .fs1 .fc0 .sc0 .ls0 .ws0}
standardUserDefaults\] objectForKey:@\"currentReminderId\"\]; if
(currentReminderId) { // 增加
:::

::: {.t .m0 .x1 .h4 .y5 .ff2 .fs1 .fc0 .sc0 .ls0 .ws0}
前一个 reminderId currentReminderId = @(\[currentReminderId intValue\] +
1); } else { //
:::

::: {.t .m0 .x1 .h4 .y6 .ff2 .fs1 .fc0 .sc0 .ls0 .ws0}
如果还没有，设为 0 currentReminderId = \@0; } // 将 currentReminderId
更新到 model 中
:::

::: {.t .m0 .x1 .h4 .y7 .ff2 .fs1 .fc0 .sc0 .ls0 .ws0}
\[\[NSUserDefaults standardUserDefaults\] setObject:currentReminderId
forKey:@\"currentReminderId\"\];
:::

::: {.t .m0 .x1 .h4 .y8 .ff2 .fs1 .fc0 .sc0 .ls0 .ws0}
return currentReminderId;}
:::

::: {.t .m0 .x1 .h3 .y9 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
如何针对这个方法编写单元测试呢？这里需要注意一点，该方法中操作了一个不属于其控制
:::

::: {.t .m0 .x1 .h3 .ya .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
的对象[NSUserDefaults]{.ff2 .fs1}。
:::

::: {.t .m0 .x1 .h3 .yb .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
容我赘述，就这个例子展开说，虽然这里我使用了[NSUserDefaults]{.ff2
.fs1}，但这背后显然有一个更大
:::

::: {.t .m0 .x1 .h3 .yc .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
的范畴。这个问题不仅仅是"如何去测试一个操作了[NSUserDefaults]{.ff2
.fs1}的方法？"，而可以演
:::

::: {.t .m0 .x1 .h3 .yd .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
化为"若一个对象对于[快速且可重复]{.fc1}的测试有着直接影响，如何对一个依赖这种对象的方法
:::

::: {.t .m0 .x1 .h3 .ye .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
进行单元测试呢？"。
:::

::: {.t .m0 .x1 .h3 .yf .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
目前此类单元测试的最大障碍是，如何在你想要测试的代码之外的地方处理这种依赖关系。
:::

::: {.t .m0 .x1 .h3 .y10 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
依赖注入(dependencyinjection，简称DI)这一范畴内就有一系列方法专门用于解决此类
:::

::: {.t .m0 .x1 .h3 .y11 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
问题。
:::

::: {.t .m0 .x1 .h5 .y12 .ff3 .fs2 .fc0 .sc0 .ls0 .ws0}
依赖注入的几种形式
:::

::: {.t .m0 .x1 .h3 .y13 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
其实一提到DI，很多人会直接想到依赖注入框架或者是控制反转(InversionofControl简
:::

::: {.t .m0 .x1 .h3 .y14 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
称IoC)容器。请把这些概念都暂且搁置，我会在后面的FAQ(常见问题)中做说明。
:::

::: {.t .m0 .x1 .h3 .y15 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
现行有很多技术可以处理在依赖中注入某些东西这件事情。比如说Objective-Cruntime中
:::

::: {.t .m0 .x1 .h3 .y16 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
的swizzling就是其一，swizzling可以在运行时动态地将方法进行替换。当然也有人提出
:::

::: {.t .m0 .x1 .h3 .y17 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
质疑，他们觉得[swizzling的存在让DI变得无关紧要]{.fc1}，甚至应尽量避免使用DI。但是我更
:::

::: {.t .m0 .x1 .h3 .y18 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
倾向于那些使依赖关系能够清晰化的代码，因为这样更便于观察它们(并且促使我们去处理
:::

::: {.t .m0 .x1 .h3 .y19 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
那些由于依赖过于复杂而导致的变坏或者错误的代码)。
:::

::: {.t .m0 .x1 .h3 .y1a .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
接下来我们快速了解一下DI的形式。其中除一个以外，其他的例子都来自于Mark
:::

::: {.t .m0 .x1 .h3 .y1b .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
Seemann的
:::

::: {.t .m0 .x1 .h6 .y1c .ff3 .fs3 .fc0 .sc0 .ls0 .ws0}
构造器注入
:::

::: {.t .m0 .x1 .h7 .y1d .ff3 .fs0 .fc0 .sc0 .ls0 .ws0}
注意：尽管Objective-C本身没有所谓的构造器而是使用初始化方法，但因为构造器注入
:::

::: {.t .m0 .x1 .h7 .y1e .ff3 .fs0 .fc0 .sc0 .ls0 .ws0}
是DI的标准概念，放到各种语言中也是普遍适用的，所以我还是准备用构造器注入这个词
:::

::: {.t .m0 .x1 .h7 .y1f .ff3 .fs0 .fc0 .sc0 .ls0 .ws0}
来代指初始化注入。
:::

::: {.t .m0 .x1 .h3 .y20 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
构造器注入，即将某个依赖对象传入到构造器中(在Objective-C中指designated初始化
:::

::: {.t .m0 .x1 .h3 .y21 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
方法)并存储起来，以便在后续过程中使用：
:::

::: {.t .m0 .x1 .h4 .y22 .ff2 .fs1 .fc0 .sc0 .ls0 .ws0}
\@interface Example ()\@property (nonatomic, strong, readonly)
NSUserDefaults
:::

::: {.t .m0 .x1 .h4 .y23 .ff2 .fs1 .fc0 .sc0 .ls0 .ws0}
\*userDefaults;\@end\@implementation Example-
(instancetype)initWithUserDefaults:(NSUserDefaults
:::

::: {.t .m0 .x1 .h4 .y24 .ff2 .fs1 .fc0 .sc0 .ls0 .ws0}
\*userDefaults){ self = \[super init\]; if (self) { \_userDefaults =
userDefaults; }
:::

::: {.t .m0 .x1 .h4 .y25 .ff2 .fs1 .fc0 .sc0 .ls0 .ws0}
return self;}\@end
:::
:::

[](http://pragprog.com/magazines/2012-01/unit-tests-are-first){.l}

::: {.d .m1 style="border-style:none;position:absolute;left:179.815430px;bottom:563.885010px;width:72.036300px;height:14.257200px;background-color:rgba(255,255,255,0.000001);"}
:::

[](http://sharpfivesoftware.com/2013/03/20/dependency-injection-is-not-a-virtue-in-objective-c/){.l}

::: {.d .m1 style="border-style:none;position:absolute;left:143.797272px;bottom:343.273830px;width:194.347958px;height:14.257210px;background-color:rgba(255,255,255,0.000001);"}
:::

[](http://www.amazon.com/Dependency-Injection-NET-Mark-Seemann/dp/1935182501){.l}

::: {.d .m1 style="border-style:none;position:absolute;left:128.039337px;bottom:259.231510px;width:167.334323px;height:14.257140px;background-color:rgba(255,255,255,0.000001);"}
:::
:::

::: {.pi data="{\"ctm\":[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}"}
:::
:::

::: {#pf2 .pf .w0 .h0 page-no="2"}
::: {.pc .pc2 .w0 .h0}
![](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAA+AAAAXLCAIAAAAz/kHlAAAACXBIWXMAABYlAAAWJQFJUiTwAAAY1UlEQVR42uzWMQEAAAjDMMC/580GRyKhVzfJAAAAP5wEAABg0AEAAIMOAAAGHQAAMOgAAGDQAQAAgw4AAAYdAAAw6AAAYNABAACDDgAABh0AADDoAACAQQcAAIMOAAAYdAAAMOgAAIBBBwAAgw4AABh0AAAw6AAAgEEHAACDDgAAGHQAADDoAACAQQcAAAw6AAAYdAAAwKADAIBBBwAADDoAABh0AADAoAMAgEEHAAAMOgAAGHQAAMCgAwCAQQcAAAw6AABg0AEAwKADAAAGHQAADDoAAGDQAQDAoAMAAAYdAAAMOgAAYNABAMCgAwAABh0AAAw6AABg0AEAAIMOAAAGHQAAMOgAAGDQAQAAgw4AAAYdAAAw6AAAYNABAACDDgAABh0AADDoAABg0AEAAIMOAAAYdAAAMOgAAIBBBwAAgw4AABh0AAAw6AAAgEEHAACDDgAAGHQAADDoAACAQQcAAIMOAAAYdAAAwKADAIBBBwAADDoAABh0AADAoAMAgEEHAAAMOgAAGHQAAMCgAwCAQQcAAAw6AAAYdAAAwKADAAAGHQAADDoAAGDQAQDAoAMAAAYdAAAMOgAAYNABAMCgAwAABh0AAAw6AABg0AEAwKADAAAGHQAAMOgAAGDQAQAAgw4AAAYdAAAw6AAAYNABAACDDgAABh0AADDoAABg0AEAAIMOAAAGHQAAMOgAAIBBBwAAgw4AABh0AAAw6AAAgEEHAACDDgAAGHQAADDoAACAQQcAAIMOAAAYdAAAMOgAAIBBBwAADDoAABh0AADAoAMAgEEHAAAMOgAAGHQAAMCgAwCAQQcAAAw6AAAYdAAAwKADAIBBBwAADDoAAGDQAQDAoAMAAAYdAAAMOgAAYNABAMCgAwAABh0AAAw6AABg0AEAwKADAAAGHQAADDoAAGDQAQAAgw4AAAYdAAAw6AAAYNABAACDDgAABh0AADDoAABg0AEAAIMOAAAGHQAAMOgAAGDQAQAAgw4AABh0AAAw6AAAgEEHAACDDgAAGHQAADDoAACAQQcAAIMOAAAYdAAAMOgAAIBBBwAAgw4AABh0AADAoAMAgEEHAAAMOgAAGHQAAMCgAwCAQQcAAAw6AAAYdAAAwKADAIBBBwAADDoAABh0AADAoAMAAAYdAAAMOgAAYNABAMCgAwAABh0AAAw6AABg0AEAwKADAAAGHQAADDoAAGDQAQDAoAMAAAYdAAAw6AAAYNABAACDDgAABh0AADDoAABg0AEAAIMOAAAGHQAAMOgAAGDQAQAAgw4AAAYdAAAw6AAAgEEHAACDDgAAGHQAADDoAACAQQcAAIMOAAAYdAAAMOgAAIBBBwAAgw4AABh0AAAw6AAAgEEHAAAMOgAAGHQAAMCgAwCAQQcAAAw6AAAYdAAAwKADAIBBBwAADDoAABh0AADAoAMAgEEHAAAMOgAAYNABAMCgAwAABh0AAAw6AABg0AEAwKADAAAGHQAADDoAAGDQAQDAoAMAAAYdAAAMugQAAGDQAQAAgw4AAAYdAAAw6AAAYNABAACDDgAABh0AADDoAABg0AEAAIMOAAAGHQAAMOgAAIBBBwAAgw4AABh0AAAw6AAAgEEHAACDDgAAGHQAADDoAACAQQcAAIMOAAAYdAAAMOgAAIBBBwAADDoAABh0AADAoAMAgEEHAAAMOgAAGHQAAMCgAwCAQQcAAAw6AAAYdAAAwKADAIBBBwAADDoAAGDQAQDAoAMAAAYdAAAMOgAAYNABAMCgAwAABh0AAAw6AABg0AEAwKADAAAGHQAADDoAAGDQAQAAgw4AAAYdAAAw6AAAYNABAACDDgAABh0AADDoAABg0AEAAIMOAAAGHQAAMOgAAGDQAQAAgw4AABh0AAAw6AAAgEEHAACDDgAAGHQAADDoAACAQQcAAIMOAAAYdAAAMOgAAIBBBwAAgw4AABh0AADAoAMAgEEHAAAMOgAAGHQAAMCgAwCAQQcAAAw6AAAYdAAAwKADAIBBBwAADDoAABh0AADAoAMAAAYdAAAMOgAAYNABAMCgAwAABh0AAAw6AABg0AEAwKADAAAGHQAADDoAAGDQAQDAoAMAAAYdAAAw6AAAYNABAACDDgAABh0AADDoAABg0AEAAIMOAAAGHQAAMOgAAGDQAQAAgw4AAAYdAAAw6AAAgEEHAACDDgAAGHQAADDoAACAQQcAAIMOAAAYdAAAMOgAAIBBBwAAgw4AABh0AAAw6AAAgEEHAAAMOgAAGHQAAMCgAwCAQQcAAAw6AAAYdAAAwKADAIBBBwAADDoAABh0AADAoAMAgEEHAAAMOgAAYNABAMCgAwAABh0AAAw6AABg0AEAwKADAAAGHQAADDoAAGDQAQDAoAMAAAYdAAAMOgAAYNABAACDDgAABh0AADDoAABg0AEAAIMOAAAGHQAAMOgAAGDQAQAAgw4AAAYdAAAw6AAAYNABAACDDgAAGHQAADDoAACAQQcAAIMOAAAYdAAAMOgAAIBBBwAAgw4AABh0AAAw6AAAgEEHAACDDgAAGHQAAMCgAwCAQQcAAAw6AAAYdAAAwKADAIBBBwAADDoAABh0AADAoAMAgEEHAAAMOgAAGHQAAMCgAwAABh0AAAw6AABg0AEAwKADAAAGHQAADDoAAGDQAQDAoAMAAAYdAAAMOgAAYNABAMCgAwAABh0AADDoAABg0AEAAIMOAAAGHQAAMOgAAGDQAQAAgw4AAAYdAAAw6AAAYNABAACDDgAABh0AADDoAACAQQcAAIMOAAAYdAAAMOgAAIBBBwAAgw4AABh0AAAw6AAAgEEHAACDDgAAGHQAADDoAACAQQcAAAw6AAAYdAAAwKADAIBBBwAADDoAABh0AADAoAMAgEEHAAAMOgAAGHQAAMCgAwCAQQcAAAw6AABg0AEAwKADAAAGHQAADDoAAGDQAQDAoAMAAAYdAAAMOgAAYNABAMCgAwAABh0AAAy6BAAAYNABAACDDgAABh0AADDoAABg0AEAAIMOAAAGHQAAMOgAAGDQAQAAgw4AAAYdAAAw6AAAgEEHAACDDgAAGHQAADDoAACAQQcAAIMOAAAYdAAAMOgAAIBBBwAAgw4AABh0AAAw6AAAgEEHAAAMOgAAGHQAAMCgAwCAQQcAAAw6AAAYdAAAwKADAIBBBwAADDoAABh0AADAoAMAgEEHAAAMOgAAYNABAMCgAwAABh0AAAw6AABg0AEAwKADAAAGHQAADDoAAGDQAQDAoAMAAAYdAAAMOgAAYNABAACDDgAABh0AADDoAABg0AEAAIMOAAAGHQAAMOgAAGDQAQAAgw4AAAYdAAAw6AAAYNABAACDDgAAGHQAADDoAACAQQcAAIMOAAAYdAAAMOgAAIBBBwAAgw4AABh0AAAw6AAAgEEHAACDDgAAGHQAAMCgAwCAQQcAAAw6AAAYdAAAwKADAIBBBwAADDoAABh0AADAoAMAgEEHAAAMOgAAGHQAAMCgAwAABh0AAAw6AABg0AEAwKADAAAGHQAADDoAAGDQAQDAoAMAAAYdAAAMOgAAYNABAMCgAwAABh0AADDoAABg0AEAAIMOAAAGHQAAMOgAAGDQAQAAgw4AAAYdAAAw6AAAYNABAACDDgAABh0AADDoAACAQQcAAIMOAAAYdAAAMOgAAIBBBwAAgw4AABh0AAAw6AAAgEEHAACDDgAAGHQAADDoAACAQQcAAAw6AAAYdAAAwKADAIBBBwAADDoAABh0AADAoAMAgEEHAAAMOgAAGHQAAMCgAwCAQQcAAAw6AABg0AEAwKADAAAGHQAADDoAAGDQAQDAoAMAAAYdAAAMOgAAYNABAMCgAwAABh0AAAw6AABg0AEAAIMOAAAGHQAAMOgAAGDQAQAAgw4AAAYdAAAw6AAAYNABAACDDgAABh0AADDoAABg0AEAAIMOAAAYdAAAMOgAAIBBBwAAgw4AABh0AAAw6AAAgEEHAACDDgAAGHQAADDoAACAQQcAAIMOAAAYdAAAwKADAIBBBwAADDoAABh0AADAoAMAgEEHAAAMOgAAGHQAAMCgAwCAQQcAAAw6AAAYdAAAwKADAAAGHQAADDoAAGDQAQDAoAMAAAYdAAAMOgAAYNABAMCgAwAABh0AAAw6AABg0AEAwKADAAAGHQAAMOgAAGDQAQAAgw4AAAYdAAAw6AAAYNABAACDDgAABh0AADDoAABg0AEAAIMOAAAGHQAAMOgAAIBBBwAAgw4AABh0AAAw6AAAgEEHAACDDgAAGHQAADDoAACAQQcAAIMOAAAYdAAAMOgAAIBBBwAADDoAABh0AADAoAMAgEEHAAAMOgAAGHQAAMCgAwCAQQcAAAw6AAAYdAAAwKADAIBBBwAADDoAAGDQAQDAoAMAAAYdAAAMOgAAYNABAMCgAwAABh0AAAw6AABg0AEAwKADAAAGHQAADLoEAABg0AEAAIMOAAAGHQAAMOgAAGDQAQAAgw4AAAYdAAAw6AAAYNABAACDDgAABh0AADDoAACAQQcAAIMOAAAYdAAAMOgAAIBBBwAAgw4AABh0AAAw6AAAgEEHAACDDgAAGHQAADDoAACAQQcAAAw6AAAYdAAAwKADAIBBBwAADDoAABh0AADAoAMAgEEHAAAMOgAAGHQAAMCgAwCAQQcAAAw6AABg0AEAwKADAAAGHQAADDoAAGDQAQDAoAMAAAYdAAAMOgAAYNABAMCgAwAABh0AAAw6AABg0AEAAIMOAAAGHQAAMOgAAGDQAQAAgw4AAAYdAAAw6AAAYNABAACDDgAABh0AADDoAABg0AEAAIMOAAAYdAAAMOgAAIBBBwAAgw4AABh0AAAw6AAAgEEHAACDDgAAGHQAADDoAACAQQcAAIMOAAAYdAAAwKADAIBBBwAADDoAABh0AADAoAMAgEEHAAAMOgAAGHQAAMCgAwCAQQcAAAw6AAAYdAAAwKADAAAGHQAADDoAAGDQAQDAoAMAAAYdAAAMOgAAYNABAMCgAwAABh0AAAw6AABg0AEAwKADAAAGHQAAMOgAAGDQAQAAgw4AAAYdAAAw6AAAYNABAACDDgAABh0AADDoAABg0AEAAIMOAAAGHQAAMOgAAIBBBwAAgw4AABh0AAAw6AAAgEEHAACDDgAAGHQAADDoAACAQQcAAIMOAAAYdAAAMOgAAIBBBwAADDoAABh0AADAoAMAgEEHAAAMOgAAGHQAAMCgAwCAQQcAAAw6AAAYdAAAwKADAIBBBwAADDoAAGDQAQDAoAMAAAYdAAAMOgAAYNABAMCgAwAABh0AAAw6AABg0AEAwKADAAAGHQAADDoAAGDQAQAAgw4AAAYdAAAw6AAAYNABAACDDgAABh0AADDoAABg0AEAAIMOAAAGHQAAMOgAAGDQAQAAgw4AABh0AAAw6AAAgEEHAACDDgAAGHQAADDoAACAQQcAAIMOAAAYdAAAMOgAAIBBBwAAgw4AABh0AADAoAMAgEEHAAAMOgAAGHQAAMCgAwCAQQcAAAw6AAAYdAAAwKADAIBBBwAADDoAABh0AADAoAMAAAYdAAAMOgAAYNABAMCgAwAABh0AAAw6AABg0AEAwKADAAAGHQAADDoAAGDQAQDAoAMAAAYdAAAw6AAAYNABAACDDgAABh0AADDoAABg0AEAAIMOAAAGHQAAMOgAAGDQAQAAgw4AAAYdAAAw6AAAgEEHAACDDgAAGHQAADDoAACAQQcAAIMOAAAYdAAAMOgAAIBBBwAAgw4AABh0AAAw6AAAgEEHAAAMOgAAGHQAAMCgAwCAQQcAAAw6AAAYdAAAwKADAIBBBwAADDoAABh0AADAoAMAgEEHAAAMOgAAYNABAMCgAwAABh0AAAw6AABg0AEAwKADAAAGHQAADDoAAGDQAQDAoAMAAAYdAAAMugQAAGDQAQAAgw4AAAYdAAAw6AAAYNABAACDDgAABh0AADDoAABg0AEAAIMOAAAGHQAAMOgAAIBBBwAAgw4AABh0AAAw6AAAgEEHAACDDgAAGHQAADDoAACAQQcAAIMOAAAYdAAAMOgAAIBBBwAADDoAABh0AADAoAMAgEEHAAAMOgAAGHQAAMCgAwCAQQcAAAw6AAAYdAAAwKADAIBBBwAADDoAAGDQAQDAoAMAAAYdAAAMOgAAYNABAMCgAwAABh0AAAw6AABg0AEAwKADAAAGHQAADDoAAGDQAQAAgw4AAAYdAAAw6AAAYNABAACDDgAABh0AADDoAABg0AEAAIMOAAAGHQAAMOgAAGDQAQAAgw4AABh0AAAw6AAAgEEHAACDDgAAGHQAADDoAACAQQcAAIMOAAAYdAAAMOgAAIBBBwAAgw4AABh0AADAoAMAgEEHAAAMOgAAGHQAAMCgAwCAQQcAAAw6AAAYdAAAwKADAIBBBwAADDoAABh0AADAoAMAAAYdAAAMOgAAYNABAMCgAwAABh0AAAw6AABg0AEAwKADAAAGHQAADDoAAGDQAQDAoAMAAAYdAAAw6AAAYNABAACDDgAABh0AADDoAABg0AEAAIMOAAAGHQAAMOgAAGDQAQAAgw4AAAYdAAAw6AAAgEEHAACDDgAAGHQAADDoAACAQQcAAIMOAAAYdAAAMOgAAIBBBwAAgw4AABh0AAAw6AAAgEEHAAAMOgAAGHQAAMCgAwCAQQcAAAw6AAAYdAAAwKADAIBBBwAADDoAABh0AADAoAMAgEEHAAAMOgAAYNABAMCgAwAABh0AAAw6AABg0AEAwKADAAAGHQAADDoAAGDQAQDAoAMAAAYdAAAMOgAAYNABAACDDgAABh0AADDoAABg0AEAAIMOAAAGHQAAMOgAAGDQAQAAgw4AAAYdAAAw6AAAYNABAACDDgAAGHQAADDoAACAQQcAAIMOAAAYdAAAMOgAAIBBBwAAgw4AABh0AAAw6AAAgEEHAACDDgAAGHQAAMCgAwCAQQcAAAw6AAAYdAAAwKADAIBBBwAADDoAABh0AADAoAMAgEEHAAAMOgAAGHQAAMCgAwAABh0AAAw6AABg0AEAwKADAAAGHQAADDoAAGDQAQDAoAMAAAYdAAAMOgAAYNABAMCgAwAABh0AADDoAABg0AEAAIMOAAAGHQAAMOgAAGDQAQAAgw4AAAYdAAAw6AAAYNABAACDDgAABh0AADDoAACAQQcAAIMOAAAYdAAAMOgAAIBBBwAAgw4AABh0AAAw6AAAgEEHAACDDgAAGHQAADDoAACAQQcAAAw6AAAYdAAAwKADAIBBBwAADDoAABh0AADAoAMAgEEHAAAMOgAAGHQAAMCgAwCAQQcAAAw6AABg0AEAwKADAAAGHQAADDoAAGDQAQDAoAMAAAYdAAAMOgAAYNABAMCgAwAABh0AAAy6BAAAYNABAACDDgAABh0AADDoAABg0AEAAIMOAAAGHQAAMOgAAGDQAQAAgw4AAAYdAAAw6AAAgEEHAACDDgAAGHQAADDoAACAQQcAAIMOAAAYdAAAMOgAAIBBBwAAgw4AABh0AAAw6AAAgEEHAAAMOgAAGHQAAMCgAwCAQQcAAAw6AAAYdAAAwKADAIBBBwAADDoAABh0AADAoAMAgEEHAAAMOgAAYNABAMCgAwAABh0AAAw6AABg0AEAwKADAAAGHQAADDoAAGDQAQDAoAMAAAYdAAAMOgAAYNABAACDDgAABh0AADDoAABg0AEAAIMOAAAGHQAAMOgAAGDQAQAAgw4AAAYdAAAw6AAAYNABAACDDgAAGHQAADDoAACAQQcAAIMOAAAYdAAAMOgAAIBBBwAAgw4AABh0AAAw6AAAgEEHAACDDgAAGHQAAMCgAwCAQQcAAAw6AAAYdAAAwKADAIBBBwAADDoAABh0AADAoAMAgEEHAAAMOgAAGHQAAMCgAwAABh0AAAw6AABg0AEAwKADAAAGHQAADDoAAGDQAQDAoAMAAAYdAAAMOgAAYNABAMCgAwAABh0AADDoAABg0AEAAIMOAAAGHQAAMOgAAGDQAQAAgw4AAAYdAAAw6AAAYNABAACDDgAABh0AADDoAACAQQcAAIMOAAAYdAAAMOgAAIBBBwAAgw4AABh0AAAw6AAAgEEHAACDDgAAGHQAADDoQNutYwEAAACAQf7Ws9hVFAEACDoAACDoAAAg6AAAgKADAICgAwAAgg4AAIIOAAAIOgAACDoAACDoAAAg6AAAgKADAICgAwAAgg4AAAg6AAAIOgAAIOgAACDoAACAoAMAgKADAACCDgAAgg4AAAg6AAAIOgAAIOgAACDoAACAoAMAAIIOAACCDgAACDoAAAg6AAAg6AAAIOgAAICgAwCAoAMAAIIOAACCDgAACDoAAAg6AAAg6AAAgKADAICgAwAAgg4AAIIOAAAIOgAACDoAACDoAAAg6AAAgKADAICgAwAAgg4AAIIOAAAIOgAAIOgAACDoAACAoAMAgKADAACCDgAAgg4AAAg6AAAIOgAAIOgAACDoAADALoyVDpMph755AAAAAElFTkSuQmCC){.bi
.x0 .y0 .w1 .h1}

::: {.c .x0 .y1 .w1 .h2}
::: {.t .m0 .x1 .h3 .y26 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
可以用实例变量或者是属性来存储依赖对象。上面的例子中用一个只读的属性来存储，防止
:::

::: {.t .m0 .x1 .h3 .y27 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
依赖对象被篡改。
:::

::: {.t .m0 .x1 .h3 .y28 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
对[NSUserDefaults]{.ff2
.fs1}进行注入看起来会比较怪，这可能也是这个例子的不足之处。注意，
:::

::: {.t .m0 .x1 .h3 .y29 .ff2 .fs1 .fc0 .sc0 .ls0 .ws0}
NSUserDefaults[作为依赖对象，脸上就写着"麻烦制造者"这几个字。其实被注入的更应该]{.ff1
.fs0}
:::

::: {.t .m0 .x1 .h3 .y2a .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
是一个抽象类型的对象(像id这种)来作为依赖可能会比指定某个具体类型要更好一些。但
:::

::: {.t .m0 .x1 .h3 .y2b .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
本文就不做更多展开了，还是继续以[NSUserDefaults]{.ff2 .fs1}来说明。
:::

::: {.t .m0 .x1 .h3 .y2c .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
至此，这个类中每一处要使用单例[\[NSUserDefaults
standardUserDefaults\]]{.ff2 .fs1}的地方，都应该用
:::

::: {.t .m0 .x1 .h3 .y2d .ff2 .fs1 .fc0 .sc0 .ls0 .ws0}
self.userDefaults[来替代：]{.ff1 .fs0}
:::

::: {.t .m0 .x1 .h4 .y2e .ff2 .fs1 .fc0 .sc0 .ls0 .ws0}
\- (NSNumber \*)nextReminderId{ NSNumber \*currentReminderId =
\[self.userDefaults
:::

::: {.t .m0 .x1 .h4 .y2f .ff2 .fs1 .fc0 .sc0 .ls0 .ws0}
objectForKey:@\"currentReminderId\"\]; if (currentReminderId) {
currentReminderId =
:::

::: {.t .m0 .x1 .h4 .y30 .ff2 .fs1 .fc0 .sc0 .ls0 .ws0}
@(\[currentReminderId intValue\] + 1); } else { currentReminderId = \@0;
}
:::

::: {.t .m0 .x1 .h4 .y31 .ff2 .fs1 .fc0 .sc0 .ls0 .ws0}
\[self.userDefaults setObject:currentReminderId
forKey:@\"currentReminderId\"\]; return
:::

::: {.t .m0 .x1 .h4 .y32 .ff2 .fs1 .fc0 .sc0 .ls0 .ws0}
currentReminderId;}
:::

::: {.t .m0 .x1 .h6 .y33 .ff3 .fs3 .fc0 .sc0 .ls0 .ws0}
属性注入
:::

::: {.t .m0 .x1 .h3 .y34 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
对于属性注入，[nextReminderId]{.ff2
.fs1}的代码看起来和[self.userDefaults]{.ff2
.fs1}的做法是一致的。只是这次
:::

::: {.t .m0 .x1 .h3 .y35 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
不是将依赖对象传递给初始化方法，而是采用属性赋值方式：
:::

::: {.t .m0 .x1 .h4 .y36 .ff2 .fs1 .fc0 .sc0 .ls0 .ws0}
\@interface Example\@property (nonatomic, strong) NSUserDefaults
\*userDefaults;- (NSNumber
:::

::: {.t .m0 .x1 .h4 .y37 .ff2 .fs1 .fc0 .sc0 .ls0 .ws0}
\*)nextReminderId;\@end
:::

::: {.t .m0 .x1 .h3 .y38 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
现在可以在单元测试中创建一个对象，然后将需要的东西通过对[userDefaults]{.ff2
.fs1}属性进行赋
:::

::: {.t .m0 .x1 .h3 .y39 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
值。但是要是这个属性没有被预先设定的话要怎么办呢？这时，我们可以使用lazy加载的
:::

::: {.t .m0 .x1 .h3 .y3a .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
方法为其设置一个适当的默认值，这能保证始终可以通过getter拿到一个确切的值：
:::

::: {.t .m0 .x1 .h4 .y3b .ff2 .fs1 .fc0 .sc0 .ls0 .ws0}
\- (NSUserDefaults \*)userDefaults{ if (!\_userDefaults) {
\_userDefaults =
:::

::: {.t .m0 .x1 .h4 .y3c .ff2 .fs1 .fc0 .sc0 .ls0 .ws0}
\[NSUserDefaults standardUserDefaults\]; }return \_userDefaults;}
:::

::: {.t .m0 .x1 .h3 .y3d .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
这样的话，对[userDefaults]{.ff2
.fs1}来说，如果在使用者取值之前做过赋值操作，那么从
:::

::: {.t .m0 .x1 .h3 .y3e .ff2 .fs1 .fc0 .sc0 .ls0 .ws0}
self.userDefaults[得到的就是通过setter赋的值。如果这个属性在使用前未被赋值，从]{.ff1
.fs0}
:::

::: {.t .m0 .x1 .h3 .y3f .ff2 .fs1 .fc0 .sc0 .ls0 .ws0}
self.userDefaults[得到的就是]{.ff1 .fs0}\[NSUserDefaults
standardUserDefaults\][。]{.ff1 .fs0}
:::

::: {.t .m0 .x1 .h6 .y40 .ff3 .fs3 .fc0 .sc0 .ls0 .ws0}
方法注入
:::

::: {.t .m0 .x1 .h3 .y41 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
如果依赖对象只在某一个方法中被使用，则可以利用方法参数做注入：
:::

::: {.t .m0 .x1 .h4 .y42 .ff2 .fs1 .fc0 .sc0 .ls0 .ws0}
\- (NSNumber \*)nextReminderIdWithUserDefaults:(NSUserDefaults
\*)userDefaults{ NSNumber
:::

::: {.t .m0 .x1 .h4 .y43 .ff2 .fs1 .fc0 .sc0 .ls0 .ws0}
\*currentReminderId = \[userDefaults
objectForKey:@\"currentReminderId\"\]; if (currentReminderId) {
:::

::: {.t .m0 .x1 .h4 .y44 .ff2 .fs1 .fc0 .sc0 .ls0 .ws0}
currentReminderId = @(\[currentReminderId intValue\] + 1); } else {
currentReminderId = \@0;
:::

::: {.t .m0 .x1 .h4 .y45 .ff2 .fs1 .fc0 .sc0 .ls0 .ws0}
} \[userDefaults setObject:currentReminderId
forKey:@\"currentReminderId\"\]; return
:::

::: {.t .m0 .x1 .h4 .y46 .ff2 .fs1 .fc0 .sc0 .ls0 .ws0}
currentReminderId;}
:::

::: {.t .m0 .x1 .h3 .y47 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
再一次说明，这样看起来可能会很奇怪，并不是所有的例子中[NSUserDefaults]{.ff2
.fs1}作为依赖都显得
:::

::: {.t .m0 .x1 .h3 .y48 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
恰如其分。比如说这个例子中，如果使用[NSDate]{.ff2
.fs1}做注入参数传入可能更会彰显其特点(后面
:::

::: {.t .m0 .x1 .h3 .y49 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
对每种注入方式的优点做阐述的时候会有更深入的探讨)。
:::

::: {.t .m0 .x1 .h6 .y4a .ff3 .fs3 .fc0 .sc0 .ls0 .ws0}
环境上下文
:::
:::
:::

::: {.pi data="{\"ctm\":[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}"}
:::
:::

::: {#pf3 .pf .w0 .h0 page-no="3"}
::: {.pc .pc3 .w0 .h0}
![](data:image/png;base64,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AwCAQAcAAAQ6AAAIdAAAQKADAIBABwAABDoAAAh0AABAoAMAAAIdAAAEOgAAINABAECgAwAAAh0AAAQ6AAAg0AEAQKADAAACHQAABDoAACDQAQBAoAMAAAIdAAAQ6AAAINABAACBDgAAAh0AABDoAAAg0AEAAIEOAAACHQAAEOgAACDQAQAAgQ4AAAIdAAAQ6AAAgEAHAACBDgAACHQAABDoAACAQAcAAIEOAAAIdAAAEOgAAIBABwAAgQ4AAAh0AAAQ6AAAgEAHAAAEOgAACHQAAECgAwCAQAcAAAQ6AAAIdAAAQKADAIBABwAABDoAAAh0AABAoAMAgEAHAAAEOgAAINABAECgAwAAAh0AAAQ6AAAg0AEAQKADAAACHQAABDoAACDQAQBAoAMAAAIdAAAEOgAAINABAACBDgAAAh0AABDoAAAg0AEAAIEOAAACHQAAEOgAACDQAQAAgQ4AAAIdAAAQ6AAAINABAACBDgAACHQAABDoAACAQAcAAIEOAAAIdAAAEOgAAIBABwAAgQ4AAAh0AAAQ6AAAgEAHAACBDgAACHQAAECgAwCAQAcAAAQ6AAAIdAAAQKADAIBABwAABDoAAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwAAAh0AAAQ6AAAg0AEAQKADAAACHQAABDoAACDQAQBAoAMAAAIdAAAEOgAAINABAECgAwAAAh0AABDoAAAg0AEAAIEOAAACHQAAEOgAACDQAQAAgQ4AAAIdAAAQ6AAAINABAACBDgAAAh0AABDoAACAQAcAAIEOAAAIdAAAEOgAAIBABwAAgQ4AAAh0AAAQ6AAAgEAHAACBDgAACHQAABDoAACAQAcAAAQ6AAAIdAAAQKADAIBABwAABDoAAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwCAQLcCAAAQ6AAAgEAHAACBDgAACHQAABDoAACAQAcAAIEOAAAIdAAAEOgAAIBABwAAgQ4AAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwCAQAcAAAQ6AAAIdAAAQKADAIBABwAABDoAAAh0AABAoAMAAAIdAAAEOgAAINABAECgAwAAAh0AAAQ6AAAg0AEAQKADAAACHQAABDoAACDQAQBAoAMAAAIdAAAQ6AAAINABAACBDgAAAh0AABDoAAAg0AEAAIEOAAACHQAAEOgAACDQAQAAgQ4AAAIdAAAQ6AAAgEAHAACBDgAACHQAABDoAACAQAcAAIEOAAAIdAAAEOgAAIBABwAAgQ4AAAh0AAAQ6AAAgEAHAAAEOgAACHQAAECgAwCAQAcAAAQ6AAAIdAAAQKADAIBABwAABDoAAAh0AABAoAMAgEAHAAAEOgAAINABAECgAwAAAh0AAAQ6AAAg0AEAQKADAAACHQAABDoAACDQAQBAoAMAAAIdAAAEOgAAINABAACBDgAAAh0AABDoAAAg0AEAAIEOAAACHQAAEOgAACDQAQAAgQ4AAAIdAAAQ6AAAINABAACBDgAACHQAABDoAACAQAcAAIEOAAAIdAAAEOgAAIBABwAAgQ4AAAh0AAAQ6AAAgEAHAACBDgAACHQAAECgAwCAQAcAAAQ6AAAIdAAAQKADAIBABwAABDoAAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwAAAh0AAAQ6AAAg0AEAQKADAAACHQAABDoAACDQAQBAoAMAAAIdAAAEOgAAINABAECgAwAAAh0AABDoAAAg0AEAAIEOAAACHQAAEOgAACDQAQAAgQ4AAAIdAAAQ6AAAINABAACBDgAAAh0AABDoAACAQAcAAIEOAAAIdAAAEOgAAIBABwAAgQ4AAAh0AAAQ6AAAgEAHAACBDgAACHQAABDoAACAQAcAAAQ6AAAIdAAAQKADAIBABwAABDoAAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwCAQAcAAAQ6AAAg0AEAQKADAAACHQAABDoAACDQAQBAoAMAAAIdAAAEOgAAINABAECgAwAAAh0AAAQ6AAAg0AEAAIEOAAACHQAAEOgAACDQAQAAgQ4AAAIdAAAQ6AAAINABAACBDgAAAh0AABDoAAAg0AEAAIEOAAAIdAAAEOgAAIBABwAAgQ4AAAh0AAAQ6AAAgEAHAACBDgAACHQAABDoAACAQAcAAIEOAAAIdAAAQKADAIBABwAABDoAAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwCAQAcAAAQ6AAAIdAAAQKADAAACHQAABDoAACDQAQBAoAMAAAIdAAAEOgAAINABAECgAwAAAh0AAAQ6AAAg0AEAQKADAAACHQAAEOgAACDQAQAAgQ4AAAIdAAAQ6AAAINABAACBDgAAAh0AABDoAAAg0AEAAIEOAAAC3QoAAECgAwAAAh0AAAQ6AAAg0AEAQKADAAACHQAABDoAACDQAQBAoAMAAAIdAAAEOgAAINABAACBDgAAAh0AABDoAAAg0AEAAIEOAAACHQAAEOgAACDQAQAAgQ4AAAIdAAAQ6AAAINABAACBDgAACHQAABDoAACAQAcAAIEOAAAIdAAAEOgAAIBABwAAgQ4AAAh0AAAQ6AAAgEAHAACBDgAACHQAAECgAwCAQAcAAAQ6AAAIdAAAQKADAIBABwAABDoAAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwAAAh0AAAQ6AAAg0AEAQKADAAACHQAABDoAACDQAQBAoAMAAAIdAAAEOgAAINABAECgAwAAAh0AABDoAAAg0AEAAIEOAAACHQAAEOgAACDQAQAAgQ4AAAIdAAAQ6AAAINABAACBDgAAAh0AABDoAACAQAcAAIEOAAAIdAAAEOgAAIBABwAAgQ4AAAh0AAAQ6AAAgEAHAACBDgAACHQAABDoAACAQAcAAAQ6AAAIdAAAQKADAIBABwAABDoAAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwCAQAcAAAQ6AAAg0AEAQKADAAACHQAABDoAACDQAQBAoAMAAAIdAAAEOgAAINABAECgAwAAAh0AAAQ6AAAg0AEAAIEOAAACHQAAEOgAACDQAQAAgQ4AAAIdAAAQ6AAAINABAACBDgAAAh0AABDoAAAg0AEAAIEOAAAIdAAAEOgAAIBABwAAgQ4AAAh0AAAQ6AAAgEAHAACBDgAACHQAABDoAACAQAcAAIEOAAAIdAAAQKADAIBABwAABDoAAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwCAQAcAAAQ6AAAIdAAAQKADAAACHQAABDoAACDQAQBAoAMAAAIdAAAEOgAAINABAECgAwAAAh0AAAQ6AAAg0AEAQKADAAACHQAAEOgAACDQAQAAgQ4AAAIdAAAQ6AAAINABAACBDgAAAh0AABDoAAAg0AEAAIEOAAACHQAAEOgAAIBABwAAgQ4AAAh0AAAQ6AAAgEAHAACBDgAACHQAABDoAACAQAcAAIEOAAAIdAAAEOgAAIBABwAABDoAAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwCAQAcAAAQ6AAAIdAAAQKADAIBABwAABDoAACDQAQBAoAMAAAIdAAAEOgAAINABAECgAwAAAh0AAAQ6AAAg0AEAQKADAAACHQAABDoAACDQAQAAgQ4AAAIdAAAQ6AAAINABAACBDgAAAh0AABDoAAAg0AEAAIEOAAACHQAAEOgAACDQAQAAgQ4AAAh0AAAQ6AAAgEAHAACBDgAACHQAABDoAACAQAcAAIEOAAAIdAAAEOgAAIBABwAAgQ4AAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwCAQAcAAAQ6AAAIdAAAQKADAIBABwAABDoAAAh0KwAAAIEOAAAIdAAAEOgAAIBABwAAgQ4AAAh0AAAQ6AAAgEAHAACBDgAACHQAABDoAACAQAcAAAQ6AAAIdAAAQKADAIBABwAABDoAAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwCAQAcAAAQ6AAAg0AEAQKADAAACHQAABDoAACDQAQBAoAMAAAIdAAAEOgAAINABAECgAwAAAh0AAAQ6AAAg0AEAAIEOAAACHQAAEOgAACDQAQAAgQ4AAAIdAAAQ6AAAINABAACBDgAAAh0AABDoAAAg0AEAAIEOAAAIdAAAEOgAAIBABwAAgQ4AAAh0AAAQ6AAAgEAHAACBDgAACHQAABDoAACAQAcAAIEOAAAIdAAAQKADAIBABwAABDoAAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwCAQAcAAAQ6AAAIdAAAQKADAAACHQAABDoAACDQAQBAoAMAAAIdAAAEOgAAINABAECgAwAAAh0AAAQ6AAAg0AEAQKADAAACHQAAEOgAACDQAQAAgQ4AAAIdAAAQ6AAAINABAACBDgAAAh0AABDoAAAg0AEAAIEOAAACHQAAEOgAAIBABwAAgQ4AAAh0AAAQ6AAAgEAHAACBDgAACHQAABDoAACAQAcAAIEOAAAIdAAAEOgAAIBABwAABDoAAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwCAQAcAAAQ6AAAIdAAAQKADAIBABwAABDoAACDQAQBAoAMAAAIdAAAEOgAAINABAECgAwAAAh0AAAQ6AAAg0AEAQKADAAACHQAABDoAACDQAQAAgQ4AAAIdAAAQ6AAAINABAACBDgAAAh0AABDoAAAg0AEAAIEOAAACHQAAEOgAACDQAQAAgQ4AAAh0AAAQ6AAAgEAHAACBDgAACHQAABDoAACAQAcAAIEOAAAIdAAAEOgAAIBABwAAgQ4AAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwCAQAcAAAQ6AAAIdAAAQKADAIBABwAABDrwu906pgEAAAAQ1L+1OdwggpcAgEEHAAAMOgAAYNABAMCgAwAABh0AAAw6AABg0AEAwKADAAAGHQAADDoAAGDQAQDAoAMAAAYdAAAMOgAAYNABAACDDgAABh0AADDoAABg0AEAAIMOAAAGHQAAMOgAAGDQAQAAgw4AAAYdAAAw6AAAYNABAACDDgAAGHQAADDoAACAQQcAAIMOAAAYdAAAMOgAAIBBBwAAgw4AABh0AAAw6AAAgEEHAACDDgAAGHQAAMCgAwCAQQcAAAw6AAAYdAAAwKADAIBBBwAADDoAABh0AADAoAMAgEEHAAAMOgAAGHQAAMCgAwAABh0AAAw6AABg0AEAwKADAAAGHQAADDoAAGDQAQDAoAMAAAYdAAAMOgAAYNABAMCgAwAABh0AADDoAABg0AEAAIMOAAAGHQAAMOgAAGDQAQAAgw4AAAYdAAAw6AAAYNABAACDDgAABl0CAAAw6AAAgEEHAACDDgAAGHQAAPgJk7+Z3dujF54AAAAASUVORK5CYII=){.bi
.x0 .y0 .w1 .h1}

::: {.c .x0 .y4b .w1 .h8}
::: {.t .m0 .x1 .h3 .y4c .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
当通过一个类方法(例如单例)来访问依赖对象时，在单元测试中可以通过两种方式来控制依
:::

::: {.t .m0 .x1 .h3 .y4d .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
赖对象：
:::

::: {.t .m0 .x2 .h3 .y4e .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
如果可以控制单例本身，则可以通过[公开其属性]{.ff3}来控制其状态。
:::

::: {.t .m0 .x2 .h3 .y4f .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
如果上述方式无效或者所操作的单例不归自己管理，[此时就该运用swizzle了]{.ff3}：直
:::

::: {.t .m0 .x3 .h3 .y50 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
接替换类方法，让其返回你所期望的返回值。
:::

::: {.t .m0 .x1 .h3 .y51 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
这里不会给出具体的swizzling的例子；相关的资源有很多，感兴趣的读者可以自行查找。
:::

::: {.t .m0 .x1 .h3 .y52 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
这边要说明的就是swizzling[确实可以]{.ff3}用于DI。在以上的对DI形式的简单介绍后，我们会
:::

::: {.t .m0 .x1 .h3 .y53 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
对它们各自的优缺点做进一步的对比分析，请大家继续阅读。
:::

::: {.t .m0 .x1 .h6 .y54 .ff3 .fs3 .fc0 .sc0 .ls0 .ws0}
抽取和重写调用
:::

::: {.t .m0 .x1 .h3 .y55 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
最后要说的这个技术点不在Seemann书中所涉及的DI形式讨论的范畴。关于抽取和重写
:::

::: {.t .m0 .x1 .h3 .y56 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
调用来自于MichaelFeathers的[WorkingEffectivelyWithLegacyCode]{.fc1}。下面介绍一下
:::

::: {.t .m0 .x1 .h3 .y57 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
如何将这个概念应用到我们的[NSUserDefaults]{.ff2
.fs1}例子中去，具体分为三步：
:::

::: {.t .m0 .x1 .h3 .y58 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
步骤1：随便找一处对[\[NSUserDefaults standardUserDefaults\]]{.ff2
.fs1}的调用。利用IDE(Xcode或者
:::

::: {.t .m0 .x1 .h3 .y59 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
AppCode)的自动重构功能将其抽取成一个新的方法。
:::

::: {.t .m0 .x1 .h3 .y5a .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
步骤2：将其他所有对[\[NSUserDefaults standardUserDefaults\]]{.ff2
.fs1}的调用均替换成步骤1中抽取的
:::

::: {.t .m0 .x1 .h3 .y5b .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
方法(注意不要把已抽取的方法中的[\[NSUserDefaults
standardUserDefaults\]]{.ff2 .fs1}替换成方法自身，
:::

::: {.t .m0 .x1 .h3 .y5c .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
囧)。
:::

::: {.t .m0 .x1 .h3 .y5d .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
修改后的代码如下：
:::

::: {.t .m0 .x1 .h4 .y5e .ff2 .fs1 .fc0 .sc0 .ls0 .ws0}
\- (NSNumber \*)nextReminderId{ NSNumber \*currentReminderId = \[\[self
userDefaults\]
:::

::: {.t .m0 .x1 .h4 .y5f .ff2 .fs1 .fc0 .sc0 .ls0 .ws0}
objectForKey:@\"currentReminderId\"\]; if (currentReminderId) {
currentReminderId =
:::

::: {.t .m0 .x1 .h4 .y60 .ff2 .fs1 .fc0 .sc0 .ls0 .ws0}
@(\[currentReminderId intValue\] + 1); } else { currentReminderId = \@0;
} \[\[self
:::

::: {.t .m0 .x1 .h4 .y61 .ff2 .fs1 .fc0 .sc0 .ls0 .ws0}
userDefaults\] setObject:currentReminderId
forKey:@\"currentReminderId\"\]; return
:::

::: {.t .m0 .x1 .h4 .y62 .ff2 .fs1 .fc0 .sc0 .ls0 .ws0}
currentReminderId;}- (NSUserDefaults \*)userDefaults{ return
\[NSUserDefaults
:::

::: {.t .m0 .x1 .h4 .y63 .ff2 .fs1 .fc0 .sc0 .ls0 .ws0}
standardUserDefaults\];}
:::

::: {.t .m0 .x1 .h3 .y64 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
妥当完成后，进入最后一步：
:::

::: {.t .m0 .x1 .h3 .y65 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
步骤3：创建一个专门的[测试子类]{.ff3}，重写刚刚抽取的方法：
:::

::: {.t .m0 .x1 .h4 .y66 .ff2 .fs1 .fc0 .sc0 .ls0 .ws0}
\@interface TestingExample : Example\@end\@implementation
TestingExample- (NSUserDefaults
:::

::: {.t .m0 .x1 .h4 .y67 .ff2 .fs1 .fc0 .sc0 .ls0 .ws0}
\*)userDefaults{ // Do whatever you want!}\@end
:::

::: {.t .m0 .x1 .h3 .y68 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
这样就不再初始化[Example]{.ff2
.fs1}，而是利用创建[TestingExample]{.ff2
.fs1}来进行测试，至此就可以全权掌控
:::

::: {.t .m0 .x1 .h3 .y69 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
任何对[\[self userDefaults\]]{.ff2 .fs1}的调用结果了。
:::

::: {.t .m0 .x1 .h5 .y6a .ff3 .fs2 .fc0 .sc0 .ls0 .ws0}
"究竟该选择使用哪种形式？"
:::

::: {.t .m0 .x1 .h3 .y6b .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
现在，一共提到了五种DI的形式。每一种都有其自身的优缺点和适用场景。
:::

::: {.t .m0 .x1 .h6 .y6c .ff3 .fs3 .fc0 .sc0 .ls0 .ws0}
构造器注入
:::

::: {.t .m0 .x1 .h3 .y6d .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
基本上，构造器注入应该作为首选武器存在。其优势就是[让所涉及的依赖非常清晰]{.ff3}。
:::

::: {.t .m0 .x1 .h3 .y6e .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
其缺点便是，乍一看会给人一种非常笨重的感觉。当初始化方法包含了一大堆依赖对象作为
:::

::: {.t .m0 .x1 .h3 .y6f .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
参数的时候尤甚。但这恰巧揭示了前文所提及的腐烂代码味道的问题：这个类的依赖对象是
:::
:::

[](http://www.amazon.com/Working-Effectively-Legacy-Michael-Feathers/dp/0131177052){.l}

::: {.d .m1 style="border-style:none;position:absolute;left:236.093800px;bottom:561.633910px;width:218.360060px;height:14.257200px;background-color:rgba(255,255,255,0.000001);"}
:::
:::

::: {.pi data="{\"ctm\":[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}"}
:::
:::

::: {#pf4 .pf .w0 .h0 page-no="4"}
::: {.pc .pc4 .w0 .h0}
![](data:image/png;base64,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AAAIdAAAEOgAAIBABwAAgQ4AAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwCAQAcAAAQ6AAAIdAAAQKADAIBABwAABDoAAAh0AABAoAMAAAIdAAAEOgAAINABAECgAwAAAh0AAAQ6AAAg0AEAQKADAAACHQAABDoAACDQAQBAoAMAAAIdAAAQ6AAAINABAACBDgAAAh0AABDoAAAg0AEAAIEOAAACHQAAEOgAACDQAQAAgQ4AAAIdAAAQ6AAAgEAHAACBDgAACHQAABDoAACAQAcAAIEOAAAIdAAAEOgAAIBABwAAgQ4AAAh0AAAQ6AAAgEAHAAAEOgAACHQAAECgAwCAQAcAAAQ6AAAIdAAAQKADAIBABwAABDoAAAh0AABAoAMAgEAHAAAEOgAAINABAECgAwAAAh0AAAQ6AAAg0AEAQKADAAACHQAABDoAACDQAQBAoAMAAAIdAAAEOgAAINABAACBDgAAAh0AABDoAAAg0AEAAIEOAAACHQAAEOgAACDQAQAAgQ4AAAIdAAAQ6AAAINABAACBDgAACHQAABDoAACAQAcAAIEOAAAIdAAAEOgAAIBABwAAgQ4AAAh0AAAQ6AAAgEAHAACBDgAACHQAAECgAwCAQAcAAAQ6AAAIdAAAQKADAIBABwAABDoAAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwAAAh0AAAQ6AAAg0AEAQKADAAACHQAABDoAACDQAQBAoAMAAAIdAAAEOgAAINABAECgAwAAAh0AABDoAAAg0AEAAIEOAAACHQAAEOgAACDQAQAAgQ4AAAIdAAAQ6AAAINABAACBDgAAAt0RAACAQAcAAAQ6AAAIdAAAQKADAIBABwAABDoAAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwAAAh0AAAQ6AAAg0AEAQKADAAACHQAABDoAACDQAQBAoAMAAAIdAAAEOgAAINABAECgAwAAAh0AABDoAAAg0AEAAIEOAAACHQAAEOgAACDQAQAAgQ4AAAIdAAAQ6AAAINABAACBDgAAAh0AABDoAACAQAcAAIEOAAAIdAAAEOgAAIBABwAAgQ4AAAh0AAAQ6AAAgEAHAACBDgAACHQAABDoAACAQAcAAAQ6AAAIdAAAQKADAIBABwAABDoAAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwCAQAcAAAQ6AAAg0AEAQKADAAACHQAABDoAACDQAQBAoAMAAAIdAAAEOgAAINABAECgAwAAAh0AAAQ6AAAg0AEAAIEOAAACHQAAEOgAACDQAQAAgQ4AAAIdAAAQ6AAAINABAACBDgAAAh0AABDoAAAg0AEAAIEOAAAIdAAAEOgAAIBABwAAgQ4AAAh0AAAQ6AAAgEAHAACBDgAACHQAABDoAACAQAcAAIEOAAAIdAAAQKADAIBABwAABDoAAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwCAQAcAAAQ6AAAIdAAAQKADAAACHQAABDoAACDQAQBAoAMAAAIdAAAEOgAAINABAECgAwAAAh0AAAQ6AAAg0AEAQKADAAACHQAAEOgAACDQAQAAgQ4AAAIdAAAQ6AAAINABAACBDgAAAh0AABDoAAAg0AEAAIEOAAACHQAAEOgAAIBABwAAgQ4AAAh0AAAQ6AAAgEAHAACBDgAACHQAABDoAACAQAcAAIEOAAAIdAAAEOgAAIBABwAABDoAAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwCAQAcAAAQ6AAAIdAAAQKADAIBABwAABDoAACDQAQBAoAMAAAIdAAAEOgAAINABAECgAwAAAh0AAAQ6AAAg0AEAQKADAAACHQAABDoAACDQAQAAgQ4AAAIdAAAQ6AAAINABAACBDgAAAh0AABDoAAAg0AEAAIEOAAACHQAAEOgAACDQAQAAgQ4AAAh0AAAQ6AAAgEAHAACBDgAACHQAABDoAACAQAcAAIEOAAAIdAAAEOgAAIBABwAAgQ4AAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwCAQAcAAAQ6AAAIdAAAQKADAIBABwAABDoAAAh0AABAoAMAAAIdAAAEOgAAINABAECgAwAAAh0AAAQ6AAAg0AEAQKADAAACHQAABDoAACDQAQBAoAMAAAIdAAAQ6AAAINABAACBDgAAAh0AABDoAAAg0AEAAIEOAAACHQAAEOgAACDQAQAAgQ4AAAIdAAAQ6AAAgEAHAACBDgAACHQAABDoAACAQAcAAIEOAAAIdAAAEOgAAIBABwAAgQ4AAAh0AAAQ6I4AAAAEOgAAINABAECgAwAAAh0AAAQ6AAAg0AEAQKADAAACHQAABDoAACDQAQBAoAMAAAIdAAAQ6AAAINABAACBDgAAAh0AABDoAAAg0AEAAIEOAAACHQAAEOgAACDQAQAAgQ4AAAIdAAAQ6AAAgEAHAACBDgAACHQAABDoAACAQAcAAIEOAAAIdAAAEOgAAIBABwAAgQ4AAAh0AAAQ6AAAwMGcOAIAopUk3xwC/L4Q3jiEPvzoCyE4BQAAiIQrLgAAINABAACBDgAAAh0AABDoAAAg0AEAAIEOAAACHQAAEOgAACDQAQAAgQ4AAAIdAAAQ6AAAgEAHAACBDgAACHQAABDoAACAQAcAAIEOAAAIdAAAEOgAAIBABwAAgQ4AAAh0AAAQ6AAAgEAHAAAEOgAACHQAAECgAwCAQAcAAAQ6AAAIdAAAQKADAIBABwAABDoAAAh0AABAoAMAgEAHAAAEOgAAINABAECgAwAAAh0AAAQ6AAAg0AEAQKADAAACHQAABDoAACDQAQBAoAMAAAIdAAAEOgAAINABAACBDgAAAh0AABDoAAAg0AEAAIEOAAACHQAAEOgAACDQAQAAgQ4AAAIdAAAQ6AAAINABAACBDgAACHQAABDoAACAQAcAAIEOAAAIdAAAEOgAAIBABwAAgQ4AAAh0AAAQ6AAAgEAHAACBDgAACHQAAECgAwCAQAcAAAQ6AAAIdAAAQKADAIBABwAABDoAAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwAAAh0AAAQ6AAAg0AEAQKADAAACHQAABDoAACDQAQBAoAMAAAIdAAAEOgAAINABAECgAwAAAh0AABDoAAAg0AEAAIEOAAACHQAAEOgAACDQAQAAgQ4AAAIdAAAQ6AAAINABAACBDgAAAh0AABDoAACAQAcAAIEOAAAIdAAAEOgAAIBABwAAgQ4AAAh0AAAQ6AAAgEAHAACBDgAACHQAABDoAACAQAcAAAQ6AAAIdAAAQKADAIBABwAABDoAAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwCAQAcAAAQ6AAAg0AEAQKADAAACHQAABDoAACDQAQBAoAMAAAIdAAAEOgAAINABAECgAwAAAh0AAAQ6AAAg0AEAAIEOAAACHQAAEOgAACDQAQAAgQ4AAAIdAAAQ6AAAINABAACBDgAAAh0AABDoAAAg0AEAAIEOAAAIdAAAEOgAAIBABwAAgQ4AAAh0AAAQ6AAAgEAHAACBDgAACHQAABDoAACAQAcAAIEOAAAIdAAAQKADAIBABwAA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){.bi
.x0 .y0 .w1 .h1}

::: {.c .x0 .y70 .w1 .h9}
::: {.t .m0 .x1 .h3 .y71 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
否也[太多了些]{.ff3}？它可能已经违背了[单一职能]{.fc1}原则。
:::

::: {.t .m0 .x1 .h6 .y72 .ff3 .fs3 .fc0 .sc0 .ls0 .ws0}
属性注入
:::

::: {.t .m0 .x1 .h3 .y73 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
属性注入的长处是将初始化与注入分离，这在不能改变调用者部分的时候非常有用。那么它
:::

::: {.t .m0 .x1 .h3 .y74 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
的劣势又是什么呢？还是将初始化与注入分离！是的，你没看错。属性注入使得初始化不充
:::

::: {.t .m0 .x1 .h3 .y75 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
分。它的最佳应用场景是在依赖对象有默认值时，换句话说就是确知依赖对象可以在某个时
:::

::: {.t .m0 .x1 .h3 .y76 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
点被DI框架赋值。
:::

::: {.t .m0 .x1 .h3 .y77 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
属性注入看似容易，但[实则不然]{.ff3}，特别是如果我们想将其实现得可靠的话：
:::

::: {.t .m0 .x2 .h3 .y78 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
必须防范属性被任意重设值。这需要复写系统默认为属性生成的setter，要保证
:::

::: {.t .m0 .x3 .h3 .y79 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
相应的实例变量为nil以及传入的参数不是nil。
:::

::: {.t .m0 .x2 .h3 .y7a .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
getter是否需要线程安全？如果需要，那么与实现需要兼顾效率和线程安全的
:::

::: {.t .m0 .x3 .h3 .y7b .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
getter相比，使用构造器注入就显得容易多了。
:::

::: {.t .m0 .x1 .h3 .y7c .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
由于人们经常会对特定实例存在着固有认识，所以还应尽量避免潜意识中对使用属性注入的
:::

::: {.t .m0 .x1 .h3 .y7d .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
倾向性。另外，[请确定默认值不会引用到其他库的代码]{.ff3}。否则，当前的类的使用者还必须得
:::

::: {.t .m0 .x1 .h3 .y7e .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
去引用对应的库，这样的设计就违背了松耦合原则(用Seemann的概念来解释就是，这属
:::

::: {.t .m0 .x1 .h3 .y7f .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
于内部默认和外部默认的区别)。
:::

::: {.t .m0 .x1 .h6 .y80 .ff3 .fs3 .fc0 .sc0 .ls0 .ws0}
方法注入
:::

::: {.t .m0 .x1 .h3 .y81 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
假如所依赖的对象针对每次调用都会有所不同的话，使用方法注入会比较好。一个例子是对
:::

::: {.t .m0 .x1 .h3 .y82 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
调用点来说，可能会涉及到特定应用上下文条件的时候，比如基于一个随机数，或者是当前
:::

::: {.t .m0 .x1 .h3 .y83 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
时间等。
:::

::: {.t .m0 .x1 .h3 .y84 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
好比一个方法依赖于当前时间。不建议直接调用[\[NSDate date\]]{.ff2
.fs1}，最好在这个方法中增加一个
:::

::: {.t .m0 .x1 .h3 .y85 .ff2 .fs1 .fc0 .sc0 .ls0 .ws0}
NSDate[参数。这么做也许会增加一点点的调用复杂度，但是方法的灵活性得到了增强。]{.ff1
.fs0}
:::

::: {.t .m0 .x1 .h3 .y86 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
(虽然对Objective-C来说，不需要使用procotols也能很好的利用测试置换来做重复性测
:::

::: {.t .m0 .x1 .h3 .y87 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
试，但我还是推荐大家阅读一下J.B.Rainsberger的[\"BeyondMockObjects\"]{.fc1}。这篇文章
:::

::: {.t .m0 .x1 .h3 .y88 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
从一个有趣的应用场景出发，由一个日期注入问题引发了一系列关于设计和重用的很详实的
:::

::: {.t .m0 .x1 .h3 .y89 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
讨论。)
:::

::: {.t .m0 .x1 .h6 .y8a .ff3 .fs3 .fc0 .sc0 .ls0 .ws0}
环境上下文
:::

::: {.t .m0 .x1 .h3 .y8b .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
如果依赖对象在底层有多处应用，这就极有可能产生横切问题。若继续将依赖对象向上层传
:::

::: {.t .m0 .x1 .h3 .y8c .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
递，尤其是还无法预知这个对象将会在什么时候使用的话，便会促生干扰代码。举几个可能
:::

::: {.t .m0 .x1 .h3 .y8d .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
产生这样问题的例子：
:::

::: {.t .m0 .x2 .h3 .y8e .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
日志处理（Logging）
:::

::: {.t .m0 .x4 .h4 .y8f .ff2 .fs1 .fc0 .sc0 .ls0 .ws0}
\[NSUserDefaults standardUserDefaults\]
:::

::: {.t .m0 .x4 .h4 .y90 .ff2 .fs1 .fc0 .sc0 .ls0 .ws0}
\[NSDate date\]
:::

::: {.t .m0 .x1 .h3 .y91 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
这类场景下推荐适用环境上下文方式。由于是影响全局的上下文，使用完毕后，别忘了要将
:::

::: {.t .m0 .x1 .h3 .y92 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
其还原。比如你用swizzle替换了一个方法，需要在[tearDown]{.ff2
.fs1}或者[afterEach]{.ff2 .fs1}(取决于所使用
:::

::: {.t .m0 .x1 .h3 .y93 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
的测试框架)中对被替换的原始方法进行还原。
:::
:::

[](https://cleancoders.com/episode/clean-code-episode-9/show){.l}

::: {.d .m1 style="border-style:none;position:absolute;left:236.093800px;bottom:773.990720px;width:48.024180px;height:14.257330px;background-color:rgba(255,255,255,0.000001);"}
:::

[](http://blog.thecodewhisperer.com/2013/11/23/beyond-mock-objects/){.l}

::: {.d .m1 style="border-style:none;position:absolute;left:333.642940px;bottom:307.255620px;width:136.568850px;height:14.257080px;background-color:rgba(255,255,255,0.000001);"}
:::
:::

::: {.pi data="{\"ctm\":[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}"}
:::
:::

::: {#pf5 .pf .w0 .h0 page-no="5"}
::: {.pc .pc5 .w0 .h0}
![](data:image/png;base64,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AABAoAMAgEAHAAAEOgAAINABAECgAwAAAh0AAAQ6AAAg0AEAQKADAAACHQAABDoAACDQAQBAoAMAAAIdAAAEOgAAINABAACBDgAAAh0AABDoAAAg0AEAAIEOAAACHQAAEOgAACDQAQAAgQ4AAAIdAAAQ6AAAINABAACBDgAACHQAABDoAACAQAcAAIEOAAAIdAAAEOgAAIBABwAAgQ4AAAh0AAAQ6AAAgEAHAACBDgAACHQAAECgAwCAQAcAAAQ6AAAIdAAAQKADAIBABwAABDoAAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwAAAh0AAAQ6AAAg0AEAQKADAAACHQAABDoAACDQAQBAoAMAAAIdAAAEOgAAINABAECgAwAAAh0AABDoAAAg0AEAAIEOAAACHQAAEOgAACDQAQAAgQ4AAAIdAAAQ6AAAINABAACBDgAAAt0IAABAoAMAAAIdAAAEOgAAINABAECgAwAAAh0AAAQ6AAAg0AEAQKADAAACHQAABDoAACDQAQAAgQ4AAAIdAAAQ6AAAINABAACBDgAAAh0AABDoAAAg0AEAAIEOAAACHQAAEOgAACDQAQAAgQ4AAAh0AAAQ6AAAgEAHAACBDgAACHQAABDoAACAQAcAAIEOAAAIdAAAEOgAAIBABwAAgQ4AAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwCAQAcAAAQ6AAAIdAAAQKADAIBABwAABDoAAAh0AABAoAMAAAIdAAAEOgAAINABAECgAwAAAh0AAAQ6AAAg0AEAQKADAAACHQAABDoAACDQAQBAoAMAAAIdAAAQ6AAAINABAACBDgAAAh0AABDoAAAg0AEAAIEOAAACHQAAEOgAACDQAQAAgQ4AAAIdAAAQ6AAAgEAHAACBDgAACHQAABDoAACAQAcAAIEOAAAIdAAAEOgAAIBABwAAgQ4AAAh0AAAQ6AAAgEAHAAAEOgAACHQAAECgAwCAQAcAAAQ6AAAIdAAAQKADAIBABwAABDoAAAh0AABAoAMAgEAHAAAEOgAAINABAECgAwAAAh0AAAQ6AAAg0AEAQKADAAACHQAABDoAACDQAQBAoAMAAAIdAAAEOgAAINABAACBDgAAAh0AABDoAAAg0AEAAIEOAAACHQAAEOgAACDQAQAAgQ4AAAIdAAAQ6AAAINABAACBDgAACHQAABDoAACAQAcAAIEOAAAIdAAAEOgAAIBABwAAgQ4AAAh0AAAQ6AAAgEAHAACBDgAACHQAAECgAwCAQAcAAAQ6AAAIdAAAQKADAIBABwAABDoAAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwAAAh0AAAQ6AAAg0AEAQKADAAACHQAABDoAACDQAQBAoAMAAAIdAAAEOgAAINABAECgAwAAAh0AABDoAAAg0AEAAIEOAAACHQAAEOgAACDQAQAAgQ4AAAIdAAAQ6AAAINABAACBDgAAAh0AABDoAACAQAcAAIEOAAAIdAAAEOgAAIBABwAAgQ4AAAh0AAAQ6AAAgEAHAACBDgAACHQAABDoAACAQAcAAAQ6AAAIdAAAQKADAIBABwAABDoAAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwCAQAcAAAQ6AAAg0AEAQKADAAACHQAABDoAACDQAQBAoAMAAAIdAAAEOgAAINABAECgAwAAAh0AAAQ6AAAg0AEAAIEOAAACHQAAEOgAACDQAQAAgQ4AAAIdAAAQ6AAAINABAACBDgAAAh0AABDoAAAg0AEAAIEOAAAIdAAAEOgAAIBABwAAgQ4AAAh0AAAQ6AAAgEAHAACBDgAACHQAABDoAACAQAcAAIEOAAAIdAAAQKADAIBABwAABDoAAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwCAQAcAAAQ6AAAIdCMAAACBDgAACHQAABDoAACAQAcAAIEOAAAIdAAAEOgAAIBABwAAgQ4AAAh0AAAQ6AAAgEAHAAAEOgAACHQAAECgAwCAQAcAAAQ6AAAIdAAAQKADAIBABwAABDoAAAh0AABAoAMAgEAHAAAEOgAAINABAECgAwAAAh0AAAQ6AAAg0AEAQKADAAACHQAABDoAACDQAQBAoAMAAAIdAAAEOgAAINABAACBDgAAAh0AABDoAAAg0AEAAIEOAAACHQAAEOgAACDQAQAAgQ4AAAIdAAAQ6AAAINABAACBDgAACHQAABDoAACAQAcAAIEOAAAIdAAAEOgAAIBABwAAgQ4AAAh0AAAQ6AAAgEAHAACBDgAACHQAAECgAwCAQAcAAAQ6AAAIdAAAQKADAIBABwAABDoAAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwAAAh0AAAQ6AAAg0AEAQKADAAACHQAABDoAACDQAQBAoAMAAAIdAAAEOgAAINABAECgAwAAAh0AABDoAAAg0AEAAIEOAAACHQAAEOgAACDQAQAAgQ4AAAIdAAAQ6AAAINABAACBDgAAAh0AABDoAACAQAcAAIEOAAAIdAAAEOgAAIBABwAAgQ4AAAh0AAAQ6AAAgEAHAACBDgAACHQAABDoAACAQAcAAAQ6AAAIdAAAQKADAIBABwAABDoAAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwCAQAcAAAQ6AAAg0AEAQKADAAACHQAABDoAACDQAQBAoAMAAAIdAAAEOgAAINABAECgAwAAAh0AAAQ6AAAg0AEAAIEOAAACHQAAEOgAACDQAQAAgQ4AAAIdAAAQ6AAAINABAACBDgAAAh0AABDoAAAg0AEAAIEOAAAIdAAAEOgAAIBABwAAgQ4AAAh0AAAQ6AAAgEAHAACBDgAACHQAABDoAACAQAcAAIEOAAAIdAAAQKADAIBABwAABDoAAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwCAQAcAAAQ6AAAIdAAAQKADAAACHQAABDoAACDQAQBAoAMAAAIdAAAEOgAAINABAECgAwAAAh0AAAQ6AAAg0AEAQKADAAACHQAAEOgAACDQAQAAgQ4AAAIdAAAQ6AAAINABAACBDgAAAh0AABDoAAAg0AEAAIEOAAACHQAAEOgAAIBABwAAgQ4AAAh0AAAQ6AAAgEAHAACBDgAACHQAABDoAACAQAcAAIEOAAAIdAAAEOgAAIBABwAABDoAAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwCAQAcAAAQ6AAAIdAAAQKADAIBABwAABDoAACDQAQBAoAMAAAIdAAAEOgAAINABAKAGs995Uwh3kwLg78l5YQgAv9o752wKAABQCI+4AACAQAcAAAQ6AAAIdAAAQKADAIBABwAABDoAAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwAAAh0AAAQ6AAAg0AEAQKADAAACHQAABDoAACDQAQBAoAMAAAIdAAAEOgAAINABAECgAwAAAh0AABDoAAAg0AEAAIEOAAACHQAAEOgAACDQAQAAgQ4AAAIdAAAQ6AAAINABAACBDgAAAh0AABDoAACAQAcAAIEOAAAIdAAAEOgAAIBABwAAgQ4AAAh0AAAQ6AAAgEAHAACBDgAACHQAABDoAACAQAcAAAQ6AAAIdAAAQKADAIBABwAABDoAAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwCAQAcAAAQ6AAAg0AEAQKADAAACHQAABDoAACDQAQBAoAMAAAIdAAAEOgAAINABAECgAwAAAh0AAAQ6AAAg0AEAAIEOAAACHQAAEOgAACDQAQAAgQ4AAAIdAAAQ6AAAINABAACBDgAAAh0AABDoAAAg0AEAAIEOAAAIdAAAEOgAAIBABwAAgQ4AAAh0AAAQ6AAAgEAHAACBDgAACHQAABDoAACAQAcAAIEOAAAIdAAAQKADAIBABwAABDoAAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwCAQAcAAAQ6AAAIdAAAQKADAAACHQAABDoAACDQAQBAoAMAAAIdAAAEOgAAINABAECgAwAAAh0AAAQ6AAAg0AEAQKADAAACHQAAEOgAACDQAQAAgQ4AAAIdAAAQ6AAAINABAACBDgAAAh0AABDoAAAg0AEAAIEOAAACHQAAEOgAAIBABwAAgQ4AAAh0AAAQ6AAAgEAHAACBDgAACHQAABDoAACAQAcAAIEOAAAIdAAAEOgAAIBABwAABDoAAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwCAQAcAAAQ6AAAIdAAAQKADAIBABwAABDoAACDQAQBAoAMAAAIdAAAEOgAAINABAECgAwAAAh0AAAQ6AAAg0AEAQKADAAACHQAABDoAACDQAQAAgQ4AAAIdAAAQ6AAAINABAACBDgAAAh0AABDoAAAg0AEAAIEOAAACHQAAEOgAACDQAQAAgQ4AAAh0AAAQ6AAAgEAHAACBDgAACHQAABDoAACAQAcAAIEOAAAIdAAAEOgAAIBABwAAgQ4AAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwCAQAcAAAQ6AAAIdAAAQKADAIBABwAABDoAAAh0AABAoAMAAAIdAAAEOgAAINABAECgAwAAAh0AAAQ6AAAg0AEAQKADAAACHQAABDoAACDQAQBAoAMAAAIdAAAQ6AAAINABAACBDgAAAh0AABDoAAAg0AEAAIEOAAACHQAAEOgAACDQAQAAgQ4AAALdCAAAQKADAAACHQAABDoAACDQAQBAoAMAAAIdAAAEOgAAINABAECgAwAAAh0AAAQ6AAAg0AEAAIEOAAACHQAAEOgAACDQAQAAgQ4AAAIdAAAQ6AAAINABAACBDgAAAh0AABDoAAAg0AEAAIEOAAAIdAAAEOgAAIBABwAAgQ4AAAh0AAAQ6AAAgEAHAACBDgAACHQAABDoAACAQAcAAIEOAAAIdAAAQKADAIBABwAABDoAAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwCAQAcAAAQ6AAAIdAAAQKADAAACHQAABDoAACDQAQBAoAMAAAIdAAAEOgAAINABAECgAwAAAh0AAAQ6AAAg0AEAQKADAAACHQAAEOgAACDQAQAAgQ4AAAIdAAAQ6AAAINABAACBDgAAAh0AABDoAAAg0AEAAIEOAAACHQAAEOgAAIBABwAAgQ4AAAh0AAAQ6AAAgEAHAACBDgAACHQAABDoAACAQAcAAIEOAAAIdAAAEOgAAIBABwAABDoAAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwCAQAcAAAQ6AAAIdAAAQKADAIBABwAABDoAACDQAQBAoAMAAAIdAAAEOgAAINABAECgAwAAAh0AAAQ6AAAg0AEAQKADAAACHQAABDoAACDQAQAAgQ4AAAIdAAAQ6AAAINABAACBDgAAAh0AABDoAAAg0AEAAIEOAAACHQAAEOgAACDQAQAAgQ4AAAh0AAAQ6AAAgEAHAACBDgAACHQAABDoAACAQAcAAIEOAAAIdAAAEOgAAIBABwAAgQ4AAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwCAQAcAAAQ6AAAIdAAAQKADAIBABwAABDoAAAh0AABAoAMAAAIdAAAEOgAAINABAECgAwAAAh0AAAQ6AAAg0AEAQKADAAACHQAABDoAACDQAQBAoAMAAAIdAAAQ6AAAINABAACBDgAAAh0AABDoAAAg0AEAAIEOAAACHQAAEOgAACDQAQAAgQ4AAAIdAAAQ6AAAgEAHAACBDgAACHQAABDoAACAQAcAAIEOAAAIdAAAEOgAAIBABwAAgQ4AAAh0AAAQ6AAAgEAHAAAEOgAACHQAAECgAwCAQAcAAAQ6AAAIdAAAQKADAIBABwAABDoAAAh0AABAoAMAgEAHAAAEOgAAINABAECgAwAAAh0AAAQ6AAAg0AEAQKADAAACHQAABDoAACDQAQBAoAMAAAIdAAAEOgAAINABAACBDgAAAh0AABDoAAAg0AEAAIEOAAACHQAAEOgAACDQAQAAgQ4AAAIdAAAQ6AAAINABAACBDgAACHQAABDoAACAQAcAAIEOAAAIdAAAEOgAAIBABwAAgQ4AAAh0AAAQ6AAAgEAHAACBDgAACHQAAECgAwCAQAcAgM9265gAAAAAIFj/1oLYIrhg0AEAwKADAAAGHQAADDoAAGDQAQDAoAMAAAYdAAAMOgAAYNABAMCgSwAAAAYdAAAw6AAAYNABAACDDgAABh0AADDoAABg0AEAAIMOAAAGHQAAMOgAAGDQAQAAgw4AABh0AAAw6AAAgEEHAACDDgAAGHQAADDoAACAQQcAAIMOAAAYdAAAMOgAAIBBBwAAgw4AABh0AADAoAMAgEEHAAAMOgAAGHQAAMCgAwCAQQcAAAw6AAAYdAAAwKADAIBBBwAADDoAABh0AADAoAMAAAYdAAAMOgAAYNABAMCgAwAABh0AAAw6AABg0AEAwKADAAAGHQAADDoAAGDQAQDAoAMAAAYdAAAw6AAAYNABAACDDgAABh0AADDoAABg0AEAAIMOAAAGHQAAMOgAAGDQAQAAgw4AAAYdAAAw6AAAgEEHAACDDgAAGHQAADDoAACAQQcAAIMOAAAYdAAAMOgAAIBBBwAAgw4AABh0AAAYCr9UqNmx863cAAAAAElFTkSuQmCC){.bi
.x0 .y0 .w1 .h1}

::: {.c .x0 .y4b .w1 .h8}
::: {.t .m0 .x1 .h3 .y94 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
尽量不要自己去swizzling，推荐使用那些现成的、专注于解决与你要处理的问题类似的环
:::

::: {.t .m0 .x1 .h3 .y95 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
境上下文的库。比如：
:::

::: {.t .m0 .x2 .h3 .y96 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
网络\--[Nocilla]{.fc1}或[OHHTTPStubs]{.fc1}
:::

::: {.t .m0 .x2 .h3 .y97 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
NSDate\--[TUDelorean]{.fc1}
:::

::: {.t .m0 .x1 .h6 .y98 .ff3 .fs3 .fc0 .sc0 .ls0 .ws0}
抽取和重写调用
:::

::: {.t .m0 .x1 .h3 .y99 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
鉴于抽取和重写调用的方法使用简单，效果强大，你可能会采取能用则用的态度。但是由于
:::

::: {.t .m0 .x1 .h3 .y9a .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
这种方式需要配备特定的测试子类，这样就会相应的增加了测试的脆弱性。
:::

::: {.t .m0 .x1 .h3 .y9b .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
因为可以避免对依赖对象的调用点进行修改，通常来说，这种方式对有点年头的代码非常有
:::

::: {.t .m0 .x1 .h3 .y9c .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
效。
:::

::: {.t .m0 .x1 .h5 .y9d .ff3 .fs2 .fc0 .sc0 .ls0 .ws0}
FAQ
:::

::: {.t .m0 .x1 .h6 .y9e .ff3 .fs3 .fc0 .sc0 .ls0 .ws0}
"该用哪种DI框架？"
:::

::: {.t .m0 .x1 .h3 .y9f .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
我对那些刚开始使用mock对象的朋友们的建议是应尽量避免使用mock框架，这样你会
:::

::: {.t .m0 .x1 .h3 .ya0 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
对各个步骤和细节有更好的理解。同样地，我建议那些刚开始使用DI的朋友也不要使用任
:::

::: {.t .m0 .x1 .h3 .ya1 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
何DI框架。在不依靠DI框架的情况下，对DI的理解会更纯粹，会更明白自己该做什么，
:::

::: {.t .m0 .x1 .h3 .ya2 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
怎么做。
:::

::: {.t .m0 .x1 .h3 .ya3 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
事实上，很可能不知不觉中你已经在使用DI框架了！[它就是InterfaceBuilder]{.ff3}。IB其实不
:::

::: {.t .m0 .x1 .h3 .ya4 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
仅仅是UI设计器，任何属性都可以通过将其声明为IBOutlets来赋值。当通过IB创建的
:::

::: {.t .m0 .x1 .h3 .ya5 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
View初始化的时候，可以一并创建通过IB声明的Object(因为利用IB不仅可以创建UI
:::

::: {.t .m0 .x1 .h3 .ya6 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
对象还可以创建"Object"(NSObject类型，代表icon是个纯黄色立方体)，那么当IB
:::

::: {.t .m0 .x1 .h3 .ya7 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
文件初始化的时候，IB上定义的对象也会随之初始化)。2009年，EricSmith在其文章
:::

::: {.t .m0 .x1 .h3 .ya8 .ff1 .fs0 .fc1 .sc0 .ls0 .ws0}
"DependencyInversionPrincipleandiPhone"[中将InterfaceBuilder称为是自己]{.fc0}
:::

::: {.t .m0 .x1 .h3 .ya9 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
"一直以来最偏爱的DI框架"，文中同时给出了如何用InterfaceBuilder做依赖注入的例
:::

::: {.t .m0 .x1 .h3 .yaa .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
子。
:::

::: {.t .m0 .x1 .h3 .yab .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
如果你觉得InterfaceBuilder还不足以应付DI工作，还需要使用其他DI框架，怎么选择
:::

::: {.t .m0 .x1 .h3 .yac .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
才合适呢？我的建议是：[慎选那些需要改变你自己的代码才能使用的框架]{.ff3}。比如说继承某个
:::

::: {.t .m0 .x1 .h3 .yad .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
东西，实现某个接口，或者添加什么注解等等，这些都会将你的代码和某种特定实现捆绑在
:::

::: {.t .m0 .x1 .h3 .yae .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
一起(这与DI的根本设计哲学相悖)。反过来，应尽量去用那些不需要浸染你的类即可以从
:::

::: {.t .m0 .x1 .h3 .yaf .ff3 .fs0 .fc0 .sc0 .ls0 .ws0}
外部[连接的框架，至于说是DSL方式还是代码方式都无所谓。]{.ff1}
:::

::: {.t .m0 .x1 .h6 .yb0 .ff3 .fs3 .fc0 .sc0 .ls0 .ws0}
"不想公开全部的Hooks"
:::

::: {.t .m0 .x1 .h3 .yb1 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
对于以上几种公开注入点的注入方式，比如说初始化注入，属性注入，以及方法参数注入等
:::

::: {.t .m0 .x1 .h3 .yb2 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
都会让人有一种破坏程序封装性的感觉。我们总有一种想要掩盖依赖注入衔接点的想法，这
:::

::: {.t .m0 .x1 .h3 .yb3 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
是可以理解的，因为我们知道这些衔接点是专门为单元测试准备的，它们并不属于API业务
:::

::: {.t .m0 .x1 .h3 .yb4 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
范畴。所以可以将它们声明在category中，并且放到一个单独的头文件里。以上面的
:::
:::

[](https://github.com/luisobo/Nocilla){.l}

::: {.d .m1 style="border-style:none;position:absolute;left:152.051437px;bottom:731.969730px;width:39.770033px;height:15.758050px;background-color:rgba(255,255,255,0.000001);"}
:::

[](https://github.com/AliSoftware/OHHTTPStubs){.l}

::: {.d .m1 style="border-style:none;position:absolute;left:211.331310px;bottom:731.969730px;width:81.040850px;height:15.758050px;background-color:rgba(255,255,255,0.000001);"}
:::

[](https://github.com/tuenti/TUDelorean){.l}

::: {.d .m1 style="border-style:none;position:absolute;left:168.559750px;bottom:710.959230px;width:68.284430px;height:15.757810px;background-color:rgba(255,255,255,0.000001);"}
:::

[](http://blog.8thlight.com/eric-smith/2009/04/16/dependency-inversion-principle-and-iphone.html){.l}

::: {.d .m1 style="border-style:none;position:absolute;left:56.003025px;bottom:338.771480px;width:273.888025px;height:14.257330px;background-color:rgba(255,255,255,0.000001);"}
:::
:::

::: {.pi data="{\"ctm\":[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}"}
:::
:::

::: {#pf6 .pf .w0 .h0 page-no="6"}
::: {.pc .pc6 .w0 .h0}
![](data:image/png;base64,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AIEOAAAIdAAAQKADAIBABwAABDoAAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwCAQAcAAAQ6AAAIdAAAQKADAAACHQAABDoAACDQAQBAoAMAAAIdAAAEOgAAINABAECgAwAAAh0AAAQ6AAAg0AEAQKADAAACHQAAEOgAACDQAQAAgQ4AAAIdAAAQ6AAAINABAACBDgAAAh0AABDoAAAg0AEAAIEOAAACHQAAEOgAAIBABwAAgQ4AAAh0AAAQ6AAAgEAHAACBDgAACHQAABDoAACAQAcAAIEOAAAIdAAAEOgAAIBABwAABDoAAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwCAQAcAAAQ6AAAIdAAAQKADAIBABwAABDoAACDQAQBAoAMAAAIdAAAEOgAAINABAECgAwAAAh0AAAQ6AAAg0AEAQKADAAACHQAABDoAACDQAQAAgQ4AAAIdAAAQ6AAAINABAACBDgAAAh0AABDoAAAg0AEAAIEOAAACHQAAEOgAACDQHQEAAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwCAQAcAAAQ6AAAIdAAAQKADAIBABwAABDoAACDQAQBAoAMAAAIdAAAEOgAAINABAECgAwAAAh0AAAQ6AAAg0AEAQKADAAACHQAABDoAACDQAQAAgQ4AAAIdAAAQ6AAAINABAACBDgAAAh0AABDoAAAg0AEAAIEOAAACHQAAEOgAACDQAQAAgQ4AAAh0AAAQ6AAAgEAHAACBDgAACHQAABDoAACAQAcAAIEOAAAIdAAAEOgAAIBABwAAgQ4AAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwCAQAcAAAQ6AAAIdAAAQKADAIBABwAABDoAAAh0AABAoAMAAAIdAAAEOgAAINABAECgAwAAAh0AAAQ6AAAg0AEAQKADAAACHQAABDoAACDQAQBAoAMAAAIdAAAQ6AAAINABAACBDgAAAh0AABDoAAAg0AEAAIEOAAACHQAAEOgAACDQAQAAgQ4AAAIdAAAQ6AAAgEAHAACBDgAACHQAABDoAACAQAcAAIEOAAAIdAAAEOgAAIBABwAAgQ4AAAh0AAAQ6AAAgEAHAAAEOgAACHQAAECgAwCAQAcAAAQ6AAAIdAAAQKADAIBABwAABDoAAAh0AABAoAMAgEAHAAAEOgAAINABAECgAwAAAh0AAAQ6AAAg0AEAQKADAAACHQAABDoAACDQAQBAoAMAAAIdAAAEOgAAINABAACBDgAAAh0AABDoAAAg0AEAAIEOAAACHQAAEOgAACDQAQAAgQ4AAAIdAAAQ6AAAINABAACBDgAACHQAAEhS6QgA+E4Ibw4ByFKMl+n+740x2hAAACTCExcAABDoAACAQAcAAIEOAAAIdAAAEOgAAIBABwAAgQ4AAAh0AAAQ6AAAgEAHAACBDgAACHQAAECgAwCAQAcAAAQ6AAAIdAAAQKADAIBABwAABDoAAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwAAAh0AAAQ6AAAg0AEAQKADAAACHQAABDoAACDQAQBAoAMAAAIdAAAEOgAAINABAECgAwAAAh0AABDoAAAg0AEAAIEOAAACHQAAEOgAACDQAQAAgQ4AAAIdAAAQ6AAAINABAACBDgAAAh0AABDoAACAQAcAAIEOAAAIdAAAEOgAAIBABwAAgQ4AAAh0AAAQ6AAAgEAHAACBDgAACHQAABDoAACAQAcAAAQ6AAAIdAAAQKADAIBABwAABDoAAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwCAQAcAAAQ6AAAg0AEAQKADAAACHQAABDoAACDQAQBAoAMAAAIdAAAEOgAAINABAECgAwAAAh0AAAQ6AAAg0AEAAIEOAAACHQAAEOgAACDQAQAAgQ4AAAIdAAAQ6AAAINABAACBDgAAAh0AABDoAAAg0AEAAIEOAAAIdAAAEOgAAIBABwAAgQ4AAAh0AAAQ6AAAgEAHAACBDgAACHQAABDoAACAQAcAAIEOAAAIdAAAQKADAIBABwAABDoAAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwCAQAcAAAQ6AAAIdAAAQKADAAACHQAABDoAACDQAQBAoAMAAAIdAAAEOgAAINABAECgAwAAAh0AAAQ6AAAg0AEAQKADAAACHQAAEOgAACDQAQAAgQ4AAAIdAAAQ6AAAINABAACBDgAAAh0AABDoAAAg0AEAAIEOAAACHQAAEOgAAIBABwAAgQ4AAAh0AAAQ6AAAgEAHAACBDgAACHQAABDoAACAQAcAAIEOAAAIdAAAEOgAAIBABwAABDoAAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwCAQAcAAAQ6AAAIdAAAQKADAIBABwAABDoAACDQAQBAoAMAAAIdAAAEOgAAINABAECgAwAAAh0AAAQ6AAAg0AEAQKADAAACHQAABDoAACDQAQAAgQ4AAAIdAAAQ6AAAINABAACBDgAAAh0AABDoAAAg0AEAAIEOAAACHQAAEOgAACDQAQAAgQ4AAHxW/uSPQnhzUvwSMV46BADgP3KDDgAACQkxRqcAAACJcIMOAAACHQAAEOgAACDQAQAAgQ4AAAIdAAAQ6AAAINABAACBDgAAAh0AABDoAAAg0AEAAIEOAAAIdAAAEOgAAIBABwAAgQ4AAAh0AAAQ6AAAgEAHAACBDgAACHQAABDoAACAQAcAAIEOAAAIdAAAQKADAIBABwAABDoAAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwCAQAcAAAQ6AAAIdAAAQKADAABFUZTZfEkIb9bJ7xHjpUMAgCy5QQcAgISEGKNTAACARLhBBwAAgQ4AAAh0AAAQ6AAAgEAHAACBDgAACHQAABDoAACAQAcAAIEOAAAIdAAAEOgAAIBABwAABDoAAAh0AABAoAMAgEAHAAAEOgAACHQAAECgAwBALv4Av2Wt8VAdGqYAAAAASUVORK5CYII=){.bi
.x0 .yb5 .w1 .ha}

::: {.c .x0 .y4b .w1 .h8}
::: {.t .m0 .x1 .h3 .yb6 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
Example.h为例，再添加一个单独的头文件ExampleInternal.h。这个头文件只会被
:::

::: {.t .m0 .x1 .h3 .yb7 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
Example.m和相应的测试代码引用。
:::

::: {.t .m0 .x1 .h3 .yb8 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
在采纳这个方法去实践之前，我还要讨论一下关于DI会导致破坏程序封装原则的这个问
:::

::: {.t .m0 .x1 .h3 .yb9 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
题。其实DI的目标就是让依赖更加明显。我们界定了组件的边界和它们之间的组装方式。
:::

::: {.t .m0 .x1 .h3 .yba .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
举例来说，如果一个类的某个初始化方法中含有一个类型为[id]{.ff2
.fs1}的参数，也就是说需要提供
:::

::: {.t .m0 .x1 .h3 .ybb .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
一个满足[Foo]{.ff2
.fs1}接口的对象方可初始化这个类。好比说如果你在某个类中定义了一组插座，同
:::

::: {.t .m0 .x1 .h3 .ybc .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
时也要为其匹配相应的插头。
:::

::: {.t .m0 .x1 .h3 .ybd .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
如果觉得公开依赖会很繁冗，先看看是否符合以下的场景：
:::

::: {.t .m0 .x2 .h3 .ybe .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
公开对Apple对象的依赖是不是不太好？Apple提供的东西不就等于暗示是可用
:::

::: {.t .m0 .x3 .h3 .ybf .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
的吗，对于其他的代码是不是也应同等对待？其实不然！还是拿我们的[NSUserDefaults]{.ff2
.fs1}
:::

::: {.t .m0 .x3 .h3 .yc0 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
例子来说：假如说基于某种原因，你决定避免使用[NSUserDefaults]{.ff2
.fs1}会怎么样？若将其作
:::

::: {.t .m0 .x3 .h3 .yc1 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
为显式依赖对象而不是某个内部的实现细节，你是否会觉得这是一个需要检查整个组
:::

::: {.t .m0 .x3 .h3 .yc2 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
件的信号？你可以想想使用[NSUserDefaults]{.ff2
.fs1}是否真的违反了你在设计上的约束。
:::

::: {.t .m0 .x2 .h3 .yc3 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
是不是觉得为了达到测试目标不得已公开了许多不应公开的内部实现？首先，需
:::

::: {.t .m0 .x3 .h3 .yc4 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
要判断一下基于你的代码中现行所公开的API是否能够支撑完成测试代码编写(快速
:::

::: {.t .m0 .x3 .h3 .yc5 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
且确切)。如果不可以，并且你需要去操作那些本来是隐式的依赖对象，这说明很可能
:::

::: {.t .m0 .x3 .h3 .yc6 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
有其他的类也需要操作它。所以应该大胆将其抽象，把它当作依赖对象使用并进行单
:::

::: {.t .m0 .x3 .h3 .yc7 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
独测试。
:::

::: {.t .m0 .x1 .h5 .yc8 .ff3 .fs2 .fc0 .sc0 .ls0 .ws0}
DI不仅仅是测试
:::

::: {.t .m0 .x1 .h3 .yc9 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
我最初决定钻研DI是因为在执行测试驱动开发(TDD)，而在TDD的过程中有一个很纠结的
:::

::: {.t .m0 .x1 .h3 .yca .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
问题会时常跳出来："对于这个实现，如何编写单元测试？"。后来我发现其实DI本身是
:::

::: {.t .m0 .x1 .h3 .ycb .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
在彰显一个更高层面的概念：[代码组成了模块，模块拼接构建成了应用本身]{.ff3}。
:::

::: {.t .m0 .x1 .h3 .ycc .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
使用这种方法有很多益处。GrahamLee在文章[\"DependencyInjection,iOSandYou]{.fc1}\"
:::

::: {.t .m0 .x1 .h3 .ycd .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
中这样描述："适应新需求，解决bug，增加新功能，单独测试组件。"
:::

::: {.t .m0 .x1 .h3 .yce .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
所以当我们在编写单元测试的时候用到DI，应该回想一下上文所提到的更高层面的概念。
:::

::: {.t .m0 .x1 .h3 .ycf .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
请将[可插拔模块]{.ff3}牢记吧。它会影响你的很多设计决策，并且引导你去理解更多的DI模式和
:::

::: {.t .m0 .x1 .h3 .yd0 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
原则。
:::

::: {.t .m0 .x1 .h3 .yd1 .ff1 .fs0 .fc1 .sc0 .ls0 .ws0}
话题\#15下的更多文章
:::

::: {.t .m0 .x1 .h3 .yd2 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
原文[DependencyInjection]{.fc1}
:::
:::

[](http://www.bignerdranch.com/blog/dependency-injection-ios/){.l}

::: {.d .m1 style="border-style:none;position:absolute;left:311.881990px;bottom:301.252440px;width:207.854770px;height:14.257330px;background-color:rgba(255,255,255,0.000001);"}
:::

[](http://objccn.io/issue-15){.l}

::: {.d .m1 style="border-style:none;position:absolute;left:56.003025px;bottom:196.199710px;width:124.562785px;height:14.257320px;background-color:rgba(255,255,255,0.000001);"}
:::

[](http://www.objc.io/issue-15/dependency-injection.html){.l}

::: {.d .m1 style="border-style:none;position:absolute;left:83.767014px;bottom:175.188960px;width:125.313156px;height:14.257330px;background-color:rgba(255,255,255,0.000001);"}
:::
:::

::: {.pi data="{\"ctm\":[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}"}
:::
:::
:::

::: {.loading-indicator}
![](data:image/png;base64,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)
:::
