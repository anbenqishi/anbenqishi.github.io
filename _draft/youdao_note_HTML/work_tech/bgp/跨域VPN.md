::: {#sidebar}
::: {#outline}
:::
:::

::: {#page-container}
::: {#pf1 .pf .w0 .h0 page-no="1"}
::: {.pc .pc1 .w0 .h0}
![](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAA+AAAAXLCAIAAAAz/kHlAAAACXBIWXMAABYlAAAWJQFJUiTwAAAY1UlEQVR42uzWMQEAAAjDMMC/580GRyKhVzfJAAAAP5wEAABg0AEAAIMOAAAGHQAAMOgAAGDQAQAAgw4AAAYdAAAw6AAAYNABAACDDgAABh0AADDoAACAQQcAAIMOAAAYdAAAMOgAAIBBBwAAgw4AABh0AAAw6AAAgEEHAACDDgAAGHQAADDoAACAQQcAAAw6AAAYdAAAwKADAIBBBwAADDoAABh0AADAoAMAgEEHAAAMOgAAGHQAAMCgAwCAQQcAAAw6AABg0AEAwKADAAAGHQAADDoAAGDQAQDAoAMAAAYdAAAMOgAAYNABAMCgAwAABh0AAAw6AABg0AEAAIMOAAAGHQAAMOgAAGDQAQAAgw4AAAYdAAAw6AAAYNABAACDDgAABh0AADDoAABg0AEAAIMOAAAYdAAAMOgAAIBBBwAAgw4AABh0AAAw6AAAgEEHAACDDgAAGHQAADDoAACAQQcAAIMOAAAYdAAAwKADAIBBBwAADDoAABh0AADAoAMAgEEHAAAMOgAAGHQAAMCgAwCAQQcAAAw6AAAYdAAAwKADAAAGHQAADDoAAGDQAQDAoAMAAAYdAAAMOgAAYNABAMCgAwAABh0AAAw6AABg0AEAwKADAAAGHQAAMOgAAGDQAQAAgw4AAAYdAAAw6AAAYNABAACDDgAABh0AADDoAABg0AEAAIMOAAAGHQAAMOgAAIBBBwAAgw4AABh0AAAw6AAAgEEHAACDDgAAGHQAADDoAACAQQcAAIMOAAAYdAAAMOgAAIBBBwAADDoAABh0AADAoAMAgEEHAAAMOgAAGHQAAMCgAwCAQQcAAAw6AAAYdAAAwKADAIBBBwAADDoAAGDQAQDAoAMAAAYdAAAMOgAAYNABAMCgAwAABh0AAAw6AABg0AEAwKADAAAGHQAADDoAAGDQAQAAgw4AAAYdAAAw6AAAYNABAACDDgAABh0AADDoAABg0AEAAIMOAAAGHQAAMOgAAGDQAQAAgw4AABh0AAAw6AAAgEEHAACDDgAAGHQAADDoAACAQQcAAIMOAAAYdAAAMOgAAIBBBwAAgw4AABh0AADAoAMAgEEHAAAMOgAAGHQAAMCgAwCAQQcAAAw6AAAYdAAAwKADAIBBBwAADDoAABh0AADAoAMAAAYdAAAMOgAAYNABAMCgAwAABh0AAAw6AABg0AEAwKADAAAGHQAADDoAAGDQAQDAoAMAAAYdAAAw6AAAYNABAACDDgAABh0AADDoAABg0AEAAIMOAAAGHQAAMOgAAGDQAQAAgw4AAAYdAAAw6AAAgEEHAACDDgAAGHQAADDoAACAQQcAAIMOAAAYdAAAMOgAAIBBBwAAgw4AABh0AAAw6AAAgEEHAAAMOgAAGHQAAMCgAwCAQQcAAAw6AAAYdAAAwKADAIBBBwAADDoAABh0AADAoAMAgEEHAAAMOgAAYNABAMCgAwAABh0AAAw6AABg0AEAwKADAAAGHQAADDoAAGDQAQDAoAMAAAYdAAAMugQAAGDQAQAAgw4AAAYdAAAw6AAAYNABAACDDgAABh0AADDoAABg0AEAAIMOAAAGHQAAMOgAAIBBBwAAgw4AABh0AAAw6AAAgEEHAACDDgAAGHQAADDoAACAQQcAAIMOAAAYdAAAMOgAAIBBBwAADDoAABh0AADAoAMAgEEHAAAMOgAAGHQAAMCgAwCAQQcAAAw6AAAYdAAAwKADAIBBBwAADDoAAGDQAQDAoAMAAAYdAAAMOgAAYNABAMCgAwAABh0AAAw6AABg0AEAwKADAAAGHQAADDoAAGDQAQAAgw4AAAYdAAAw6AAAYNABAACDDgAABh0AADDoAABg0AEAAIMOAAAGHQAAMOgAAGDQAQAAgw4AABh0AAAw6AAAgEEHAACDDgAAGHQAADDoAACAQQcAAIMOAAAYdAAAMOgAAIBBBwAAgw4AABh0AADAoAMAgEEHAAAMOgAAGHQAAMCgAwCAQQcAAAw6AAAYdAAAwKADAIBBBwAADDoAABh0AADAoAMAAAYdAAAMOgAAYNABAMCgAwAABh0AAAw6AABg0AEAwKADAAAGHQAADDoAAGDQAQDAoAMAAAYdAAAw6AAAYNABAACDDgAABh0AADDoAABg0AEAAIMOAAAGHQAAMOgAAGDQAQAAgw4AAAYdAAAw6AAAgEEHAACDDgAAGHQAADDoAACAQQcAAIMOAAAYdAAAMOgAAIBBBwAAgw4AABh0AAAw6AAAgEEHAAAMOgAAGHQAAMCgAwCAQQcAAAw6AAAYdAAAwKADAIBBBwAADDoAABh0AADAoAMAgEEHAAAMOgAAYNABAMCgAwAABh0AAAw6AABg0AEAwKADAAAGHQAADDoAAGDQAQDAoAMAAAYdAAAMOgAAYNABAACDDgAABh0AADDoAABg0AEAAIMOAAAGHQAAMOgAAGDQAQAAgw4AAAYdAAAw6AAAYNABAACDDgAAGHQAADDoAACAQQcAAIMOAAAYdAAAMOgAAIBBBwAAgw4AABh0AAAw6AAAgEEHAACDDgAAGHQAAMCgAwCAQQcAAAw6AAAYdAAAwKADAIBBBwAADDoAABh0AADAoAMAgEEHAAAMOgAAGHQAAMCgAwAABh0AAAw6AABg0AEAwKADAAAGHQAADDoAAGDQAQDAoAMAAAYdAAAMOgAAYNABAMCgAwAABh0AADDoAABg0AEAAIMOAAAGHQAAMOgAAGDQAQAAgw4AAAYdAAAw6AAAYNABAACDDgAABh0AADDoAACAQQcAAIMOAAAYdAAAMOgAAIBBBwAAgw4AABh0AAAw6AAAgEEHAACDDgAAGHQAADDoAACAQQcAAAw6AAAYdAAAwKADAIBBBwAADDoAABh0AADAoAMAgEEHAAAMOgAAGHQAAMCgAwCAQQcAAAw6AABg0AEAwKADAAAGHQAADDoAAGDQAQDAoAMAAAYdAAAMOgAAYNABAMCgAwAABh0AAAy6BAAAYNABAACDDgAABh0AADDoAABg0AEAAIMOAAAGHQAAMOgAAGDQAQAAgw4AAAYdAAAw6AAAgEEHAACDDgAAGHQAADDoAACAQQcAAIMOAAAYdAAAMOgAAIBBBwAAgw4AABh0AAAw6AAAgEEHAAAMOgAAGHQAAMCgAwCAQQcAAAw6AAAYdAAAwKADAIBBBwAADDoAABh0AADAoAMAgEEHAAAMOgAAYNABAMCgAwAABh0AAAw6AABg0AEAwKADAAAGHQAADDoAAGDQAQDAoAMAAAYdAAAMOgAAYNABAACDDgAABh0AADDoAABg0AEAAIMOAAAGHQAAMOgAAGDQAQAAgw4AAAYdAAAw6AAAYNABAACDDgAAGHQAADDoAACAQQcAAIMOAAAYdAAAMOgAAIBBBwAAgw4AABh0AAAw6AAAgEEHAACDDgAAGHQAAMCgAwCAQQcAAAw6AAAYdAAAwKADAIBBBwAADDoAABh0AADAoAMAgEEHAAAMOgAAGHQAAMCgAwAABh0AAAw6AABg0AEAwKADAAAGHQAADDoAAGDQAQDAoAMAAAYdAAAMOgAAYNABAMCgAwAABh0AADDoAABg0AEAAIMOAAAGHQAAMOgAAGDQAQAAgw4AAAYdAAAw6AAAYNABAACDDgAABh0AADDoAACAQQcAAIMOAAAYdAAAMOgAAIBBBwAAgw4AABh0AAAw6AAAgEEHAACDDgAAGHQAADDoAACAQQcAAAw6AAAYdAAAwKADAIBBBwAADDoAABh0AADAoAMAgEEHAAAMOgAAGHQAAMCgAwCAQQcAAAw6AABg0AEAwKADAAAGHQAADDoAAGDQAQDAoAMAAAYdAAAMOgAAYNABAMCgAwAABh0AAAw6AABg0AEAAIMOAAAGHQAAMOgAAGDQAQAAgw4AAAYdAAAw6AAAYNABAACDDgAABh0AADDoAABg0AEAAIMOAAAYdAAAMOgAAIBBBwAAgw4AABh0AAAw6AAAgEEHAACDDgAAGHQAADDoAACAQQcAAIMOAAAYdAAAwKADAIBBBwAADDoAABh0AADAoAMAgEEHAAAMOgAAGHQAAMCgAwCAQQcAAAw6AAAYdAAAwKADAAAGHQAADDoAAGDQAQDAoAMAAAYdAAAMOgAAYNABAMCgAwAABh0AAAw6AABg0AEAwKADAAAGHQAAMOgAAGDQAQAAgw4AAAYdAAAw6AAAYNABAACDDgAABh0AADDoAABg0AEAAIMOAAAGHQAAMOgAAIBBBwAAgw4AABh0AAAw6AAAgEEHAACDDgAAGHQAADDoAACAQQcAAIMOAAAYdAAAMOgAAIBBBwAADDoAABh0AADAoAMAgEEHAAAMOgAAGHQAAMCgAwCAQQcAAAw6AAAYdAAAwKADAIBBBwAADDoAAGDQAQDAoAMAAAYdAAAMOgAAYNABAMCgAwAABh0AAAw6AABg0AEAwKADAAAGHQAADLoEAABg0AEAAIMOAAAGHQAAMOgAAGDQAQAAgw4AAAYdAAAw6AAAYNABAACDDgAABh0AADDoAACAQQcAAIMOAAAYdAAAMOgAAIBBBwAAgw4AABh0AAAw6AAAgEEHAACDDgAAGHQAADDoAACAQQcAAAw6AAAYdAAAwKADAIBBBwAADDoAABh0AADAoAMAgEEHAAAMOgAAGHQAAMCgAwCAQQcAAAw6AABg0AEAwKADAAAGHQAADDoAAGDQAQDAoAMAAAYdAAAMOgAAYNABAMCgAwAABh0AAAw6AABg0AEAAIMOAAAGHQAAMOgAAGDQAQAAgw4AAAYdAAAw6AAAYNABAACDDgAABh0AADDoAABg0AEAAIMOAAAYdAAAMOgAAIBBBwAAgw4AABh0AAAw6AAAgEEHAACDDgAAGHQAADDoAACAQQcAAIMOAAAYdAAAwKADAIBBBwAADDoAABh0AADAoAMAgEEHAAAMOgAAGHQAAMCgAwCAQQcAAAw6AAAYdAAAwKADAAAGHQAADDoAAGDQAQDAoAMAAAYdAAAMOgAAYNABAMCgAwAABh0AAAw6AABg0AEAwKADAAAGHQAAMOgAAGDQAQAAgw4AAAYdAAAw6AAAYNABAACDDgAABh0AADDoAABg0AEAAIMOAAAGHQAAMOgAAIBBBwAAgw4AABh0AAAw6AAAgEEHAACDDgAAGHQAADDoAACAQQcAAIMOAAAYdAAAMOgAAIBBBwAADDoAABh0AADAoAMAgEEHAAAMOgAAGHQAAMCgAwCAQQcAAAw6AAAYdAAAwKADAIBBBwAADDoAAGDQAQDAoAMAAAYdAAAMOgAAYNABAMCgAwAABh0AAAw6AABg0AEAwKADAAAGHQAADDoAAGDQAQAAgw4AAAYdAAAw6AAAYNABAACDDgAABh0AADDoAABg0AEAAIMOAAAGHQAAMOgAAGDQAQAAgw4AABh0AAAw6AAAgEEHAACDDgAAGHQAADDoAACAQQcAAIMOAAAYdAAAMOgAAIBBBwAAgw4AABh0AADAoAMAgEEHAAAMOgAAGHQAAMCgAwCAQQcAAAw6AAAYdAAAwKADAIBBBwAADDoAABh0AADAoAMAAAYdAAAMOgAAYNABAMCgAwAABh0AAAw6AABg0AEAwKADAAAGHQAADDoAAGDQAQDAoAMAAAYdAAAw6AAAYNABAACDDgAABh0AADDoAABg0AEAAIMOAAAGHQAAMOgAAGDQAQAAgw4AAAYdAAAw6AAAgEEHAACDDgAAGHQAADDoAACAQQcAAIMOAAAYdAAAMOgAAIBBBwAAgw4AABh0AAAw6AAAgEEHAAAMOgAAGHQAAMCgAwCAQQcAAAw6AAAYdAAAwKADAIBBBwAADDoAABh0AADAoAMAgEEHAAAMOgAAYNABAMCgAwAABh0AAAw6AABg0AEAwKADAAAGHQAADDoAAGDQAQDAoAMAAAYdAAAMugQAAGDQAQAAgw4AAAYdAAAw6AAAYNABAACDDgAABh0AADDoAABg0AEAAIMOAAAGHQAAMOgAAIBBBwAAgw4AABh0AAAw6AAAgEEHAACDDgAAGHQAADDoAACAQQcAAIMOAAAYdAAAMOgAAIBBBwAADDoAABh0AADAoAMAgEEHAAAMOgAAGHQAAMCgAwCAQQcAAAw6AAAYdAAAwKADAIBBBwAADDoAAGDQAQDAoAMAAAYdAAAMOgAAYNABAMCgAwAABh0AAAw6AABg0AEAwKADAAAGHQAADDoAAGDQAQAAgw4AAAYdAAAw6AAAYNABAACDDgAABh0AADDoAABg0AEAAIMOAAAGHQAAMOgAAGDQAQAAgw4AABh0AAAw6AAAgEEHAACDDgAAGHQAADDoAACAQQcAAIMOAAAYdAAAMOgAAIBBBwAAgw4AABh0AADAoAMAgEEHAAAMOgAAGHQAAMCgAwCAQQcAAAw6AAAYdAAAwKADAIBBBwAADDoAABh0AADAoAMAAAYdAAAMOgAAYNABAMCgAwAABh0AAAw6AABg0AEAwKADAAAGHQAADDoAAGDQAQDAoAMAAAYdAAAw6AAAYNABAACDDgAABh0AADDoAABg0AEAAIMOAAAGHQAAMOgAAGDQAQAAgw4AAAYdAAAw6AAAgEEHAACDDgAAGHQAADDoAACAQQcAAIMOAAAYdAAAMOgAAIBBBwAAgw4AABh0AAAw6AAAgEEHAAAMOgAAGHQAAMCgAwCAQQcAAAw6AAAYdAAAwKADAIBBBwAADDoAABh0AADAoAMAgEEHAAAMOgAAYNABAMCgAwAABh0AAAw6AABg0AEAwKADAAAGHQAADDoAAGDQAQDAoAMAAAYdAAAMOgAAYNABAACDDgAABh0AADDoAABg0AEAAIMOAAAGHQAAMOgAAGDQAQAAgw4AAAYdAAAw6AAAYNABAACDDgAAGHQAADDoAACAQQcAAIMOAAAYdAAAMOgAAIBBBwAAgw4AABh0AAAw6AAAgEEHAACDDgAAGHQAAMCgAwCAQQcAAAw6AAAYdAAAwKADAIBBBwAADDoAABh0AADAoAMAgEEHAAAMOgAAGHQAAMCgAwAABh0AAAw6AABg0AEAwKADAAAGHQAADDoAAGDQAQDAoAMAAAYdAAAMOgAAYNABAMCgAwAABh0AADDoAABg0AEAAIMOAAAGHQAAMOgAAGDQAQAAgw4AAAYdAAAw6AAAYNABAACDDgAABh0AADDoAACAQQcAAIMOAAAYdAAAMOgAAIBBBwAAgw4AABh0AAAw6AAAgEEHAACDDgAAGHQAADDoAACAQQcAAAw6AAAYdAAAwKADAIBBBwAADDoAABh0AADAoAMAgEEHAAAMOgAAGHQAAMCgAwCAQQcAAAw6AABg0AEAwKADAAAGHQAADDoAAGDQAQDAoAMAAAYdAAAMOgAAYNABAMCgAwAABh0AAAy6BAAAYNABAACDDgAABh0AADDoAABg0AEAAIMOAAAGHQAAMOgAAGDQAQAAgw4AAAYdAAAw6AAAgEEHAACDDgAAGHQAADDoAACAQQcAAIMOAAAYdAAAMOgAAIBBBwAAgw4AABh0AAAw6AAAgEEHAAAMOgAAGHQAAMCgAwCAQQcAAAw6AAAYdAAAwKADAIBBBwAADDoAABh0AADAoAMAgEEHAAAMOgAAYNABAMCgAwAABh0AAAw6AABg0AEAwKADAAAGHQAADDoAAGDQAQDAoAMAAAYdAAAMOgAAYNABAACDDgAABh0AADDoAABg0AEAAIMOAAAGHQAAMOgAAGDQAQAAgw4AAAYdAAAw6AAAYNABAACDDgAAGHQAADDoAACAQQcAAIMOAAAYdAAAMOgAAIBBBwAAgw4AABh0AAAw6AAAgEEHAACDDgAAGHQAAMCgAwCAQQcAAAw6AAAYdAAAwKADAIBBBwAADDoAABh0AADAoAMAgEEHAAAMOgAAGHQAAMCgAwAABh0AAAw6AABg0AEAwKADAAAGHQAADDoAAGDQAQDAoAMAAAYdAAAMOgAAYNABAMCgAwAABh0AADDoAABg0AEAAIMOAAAGHQAAMOgAAGDQAQAAgw4AAAYdAAAw6AAAYNABAACDDgAABh0AADDoAACAQQcAAIMOAAAYdAAAMOgAAIBBBwAAgw4AABh0AAAw6AAAgEEHAACDDgAAGHQAADDoQNutYwEAAACAQf7Ws9hVFAEACDoAACDoAAAg6AAAgKADAICgAwAAgg4AAIIOAAAIOgAACDoAACDoAAAg6AAAgKADAICgAwAAgg4AAAg6AAAIOgAAIOgAACDoAACAoAMAgKADAACCDgAAgg4AAAg6AAAIOgAAIOgAACDoAACAoAMAAIIOAACCDgAACDoAAAg6AAAg6AAAIOgAAICgAwCAoAMAAIIOAACCDgAACDoAAAg6AAAg6AAAgKADAICgAwAAgg4AAIIOAAAIOgAACDoAACDoAAAg6AAAgKADAICgAwAAgg4AAIIOAAAIOgAAIOgAACDoAACAoAMAgKADAACCDgAAgg4AAAg6AAAIOgAAIOgAACDoAADALoyVDpMph755AAAAAElFTkSuQmCC){.bi
.x0 .y0 .w1 .h1}

::: {.c .x0 .y1 .w1 .h2}
::: {.t .m0 .x1 .h3 .y2 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
1.Topology
:::

::: {.t .m0 .x1 .h3 .y3 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
CE1\-\-\-\-\--\[R1(PE1)\-\--R2(P)\-\--R3(ASBR1)\]\-\-\-\-\--\[R4(ASBR2)\-\-\--R5(PE2)\]\-\-\-\-\-\-\-\-\--CE2
:::

::: {.t .m0 .x1 .h3 .y4 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
\[AS100\]\[AS200\]
:::

::: {.t .m0 .x1 .h3 .y5 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
2.标签分配过程
:::

::: {.t .m0 .x1 .h3 .y6 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
PE1与ASBR1之间是两层标签，内层标签为到VPN目的网络的私网标签，PE1通过MP-IBGP分配的；
:::

::: {.t .m0 .x1 .h3 .y7 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
外层标签为到PE1Loopback接口地址的公网标签，由LDP分配的。
:::

::: {.t .m0 .x1 .h3 .y8 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
ASBR1与ASBR2之间是一层标签，为到VPN目的网络的私网标签，由ASBR1通过MP-EBGP分配的。
:::

::: {.t .m0 .x1 .h3 .y9 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
ASBR2与PE2之间是两层标签，这要分为两种情况：
:::

::: {.t .m0 .x1 .h3 .ya .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
-如果ASBR2没有执行next-hop-self，内层标签为到VPN目的网络的私网标签，是由ASBR1通过
:::

::: {.t .m0 .x1 .h3 .yb .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
MP-EBGP分配给ASBR2的，而ASBR2没有改变标签信息，通过MP-IBGP将其分配给PE2；外层标签为
:::

::: {.t .m0 .x1 .h3 .yc .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
到ASBR1与ASBR2建立EBGP的IP地址的公网标签，由LDP分配的。注意，到这个32位主机地址的IP路由
:::

::: {.t .m0 .x1 .h3 .yd .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
要发布到整个AS200中去。
:::

::: {.t .m0 .x1 .h3 .ye .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
-如果ASBR2执行了next-hop-self，内层标签为到VPN目的网络的私网标签，是由ASBR2通过MP-
:::

::: {.t .m0 .x1 .h3 .yf .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
IBGP分配的；外层标签为到ASBR2的Loopback接口地址的公网标签，由LDP分配的。
:::

::: {.t .m0 .x1 .h3 .y10 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
3.标签转发过程
:::

::: {.t .m0 .x1 .h3 .y11 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
-如果ASBR2上没有执行next-hop-self：
:::

::: {.t .m0 .x1 .h3 .y12 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
PE2上，查找VRF标签转发表，找到到VPN目的网络的下一跳地址和私网标签；由于下一跳地址为
:::

::: {.t .m0 .x1 .h3 .y13 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
ASBR1上与ASBR2建立EBGP的地址，于是递归查找到该地址的公网标签转发表，得公网标签；PE2封装
:::

::: {.t .m0 .x1 .h3 .y14 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
2层标签转发给ASBR2；
:::

::: {.t .m0 .x1 .h3 .y15 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
ASBR2上，根据公网标签执行标签转发，由于是倒数第二跳，弹出外层标签，ASBR2将只有1层VPN
:::

::: {.t .m0 .x1 .h3 .y16 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
标签的报文转发给ASBR1；
:::

::: {.t .m0 .x1 .h3 .y17 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
ASBR1上，根据私网标签执行标签转发，执行一个VPN的标签交换动作，并查到下一跳为PE1
:::

::: {.t .m0 .x1 .h3 .y18 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
Loopback地址，所以进行递归查找公网标签转发表，得公网标签；ASBR1封装2层标签转发给AS100中
:::

::: {.t .m0 .x1 .h3 .y19 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
得P，即，R2；
:::

::: {.t .m0 .x1 .h3 .y1a .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
P(R2)上，根据公网标签执行标签转发，由于是倒数第二跳，所以弹出公网标签，将只有1层VPN标签
:::

::: {.t .m0 .x1 .h3 .y1b .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
得报文转发给PE1；
:::

::: {.t .m0 .x1 .h3 .y1c .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
PE1上，根据私网标签执行标签转发，由于是最有一跳，所以弹出私网标签，将IP报文转发给CE1。
:::

::: {.t .m0 .x1 .h3 .y1d .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
-如果ASBR2上执行了next-hop-self：
:::

::: {.t .m0 .x1 .h3 .y1e .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
PE2上，查找VRF标签转发表，找到到VPN目的网络的下一跳地址和私网标签；由于下一跳地址为
:::

::: {.t .m0 .x1 .h3 .y1f .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
ASBR2Loopback接口得地址，于是递归查找到该地址的公网标签转发表，得公网标签3，即，倒数第二
:::

::: {.t .m0 .x1 .h3 .y20 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
跳；PE2只封装1层VPN标签转发给ASBR2；
:::

::: {.t .m0 .x1 .h3 .y21 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
ASBR2上，根据私网标签执行标签转发，执行一个标签交换得动作，ASBR2将只有1层VPN标签的报
:::

::: {.t .m0 .x1 .h3 .y22 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
文转发给ASBR1；
:::

::: {.t .m0 .x1 .h3 .y23 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
ASBR1上，根据私网标签执行标签转发，执行一个标签交换得动作，并查到下一跳为PE1Loopback地
:::

::: {.t .m0 .x1 .h3 .y24 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
址，所以进行递归查找公网标签转发表，得公网标签；ASBR1封装2层标签转发给AS100中得P，即，
:::

::: {.t .m0 .x1 .h3 .y25 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
R2；
:::
:::
:::

::: {.pi data="{\"ctm\":[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}"}
:::
:::

::: {#pf2 .pf .w0 .h0 page-no="2"}
::: {.pc .pc2 .w0 .h0}
![](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAA+AAAAEICAIAAABQzQnsAAAACXBIWXMAABYlAAAWJQFJUiTwAAAEgklEQVR42u3WQQ0AAAjEMMC/58MGJK2EvdZJCgAAuGEkAAAAgw4AABh0AAAw6AAAgEEHAACDDgAAGHQAADDoAACAQQcAAIMOAAAYdAAAMOgAAIBBBwAADDoAABh0AADAoAMAgEEHAAAMOgAAGHQAAMCgAwCAQQcAAAw6AAAYdAAAwKADAIBBBwAADDoAAGDQAQDAoAMAAAYdAAAMOgAAYNABAMCgAwAABh0AAAw6AABg0AEAwKADAAAGHQAADDoAAGDQAQAAgw4AAAYdAAAw6AAAYNABAACDDgAABh0AADDoAABg0AEAAIMOAAAGHQAAMOgAAGDQAQAAgw4AABh0AAAw6AAAgEEHAACDDgAAGHQAADDoAACAQQcAAIMOAAAYdAAAMOgAAIBBBwAAgw4AABh0AADAoAMAgEEHAAAMOgAAGHQAAMCgAwCAQQcAAAw6AAAYdAAAwKADAIBBBwAADDoAABh0AADAoAMAAAYdAAAMOgAAYNABAMCgAwAABh0AAAw6AABg0AEAwKADAAAGHQAADDoAAGDQAQDAoAMAAAYdAAAw6AAAYNABAACDDgAABh0AADDoAABg0AEAAIMOAAAGHQAAMOgAAGDQAQAAgw4AAAYdAAAw6AAAgEEHAACDDgAAGHQAADDoAACAQQcAAIMOAAAYdAAAMOgAAIBBBwAAgw4AABh0AAAw6AAAgEEHAAAMOgAAGHQAAMCgAwCAQQcAAAw6AAAYdAAAwKADAIBBBwAADDoAABh0AADAoAMAgEEHAAAMOgAAYNABAMCgAwAABh0AAAw6AABg0AEAwKADAAAGHQAADDoAAGDQAQDAoAMAAAYdAAAMOgAAYNABAACDDgAABh0AADDoAABg0AEAAIMOAAAGHQAAMOgAAGDQAQAAgw4AAAYdAAAw6AAAYNABAACDDgAAGHQAADDoAACAQQcAAIMOAAAYdAAAMOgAAIBBBwAAgw4AABh0AAAw6AAAgEEHAACDDgAAGHQAAMCgAwCAQQcAAAw6AAAYdAAAwKADAIBBBwAADDoAABh0AADAoAMAgEEHAAAMOgAAGHQAAMCgAwAABh0AAAw6AABg0AEAwKADAAAGHQAADDoAAGDQAQDAoAMAAAYdAAAMOgAAYNABAMCgAwAABh0AADDoAABg0AEAAIMOAAAGHQAAMOgAAGDQAQAAgw4AAAYdAAAw6AAAYNABAACDDgAABh0AADDoAACAQQcAAIMOAAAYdAAAMOgAAIBBBwAAgw4AABh0AAAw6AAAgEEHAACDDgAAGHQAADDoAACAQQcAAAw6AAAYdAAAwKADAIBBBwAADDoAABh0AADAoAMAgEEHAAAMOgAAGHQAAMCgAwCAQQcAAAw6AABg0AEAwKADAAAGHQAADDoAAGDQAQDAoAMAAAYdAAAMOgAAYNABAMCgAwAABh0AAAw6AABg0AEAAIMOAAAGHQAAMOgAAGDQAQAAgw4AAAYdAAAw6AAAYNABAACDDgAABh0AADDoAABg0CUAAACDDgAAGHQAADDoAACAQQcAgH8W4hQFDerKN48AAAAASUVORK5CYII=){.bi
.x0 .y26 .w1 .h4}

::: {.c .x0 .y1 .w1 .h2}
::: {.t .m0 .x1 .h3 .y27 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
P(R2)上，根据公网标签执行标签转发，由于是倒数第二跳，所以弹出公网标签，将只有1层VPN标签
:::

::: {.t .m0 .x1 .h3 .y28 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
得报文转发给PE1；
:::

::: {.t .m0 .x1 .h3 .y29 .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
PE1上，根据私网标签执行标签转发，由于是最有一跳，所以弹出私网标签，将IP报文转发给CE1。
:::

::: {.t .m0 .x1 .h3 .y2a .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}

:::

::: {.t .m0 .x1 .h3 .y2b .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
4.特点
:::

::: {.t .m0 .x1 .h3 .y2c .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
ASBR上维护了所有VPN的路由表和标签转发表，所以，在这个解决方案中，ASBR的压力最大，要求
:::

::: {.t .m0 .x1 .h3 .y2d .ff1 .fs0 .fc0 .sc0 .ls0 .ws0}
最高。
:::
:::
:::

::: {.pi data="{\"ctm\":[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}"}
:::
:::
:::

::: {.loading-indicator}
![](data:image/png;base64,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)
:::
